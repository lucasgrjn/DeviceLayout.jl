<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Geometry · DeviceLayout.jl</title><meta name="title" content="Geometry · DeviceLayout.jl"/><meta property="og:title" content="Geometry · DeviceLayout.jl"/><meta property="twitter:title" content="Geometry · DeviceLayout.jl"/><meta name="description" content="Documentation for DeviceLayout.jl."/><meta property="og:description" content="Documentation for DeviceLayout.jl."/><meta property="twitter:description" content="Documentation for DeviceLayout.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DeviceLayout.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Geometry-Level Layout</span><ul><li><a class="tocitem" href="../geometrylevel/">Overview</a></li><li><a class="tocitem" href="../units/">Units</a></li><li><a class="tocitem" href="../points/">Points</a></li><li class="is-active"><a class="tocitem" href>Geometry</a><ul class="internal"><li><a class="tocitem" href="#Entities"><span>Entities</span></a></li><li><a class="tocitem" href="#Structures"><span>Structures</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../transformations/">Transformations</a></li><li><a class="tocitem" href="../entitystyles/">Entity Styles</a></li><li><a class="tocitem" href="../polygons/">Polygons</a></li><li><a class="tocitem" href="../coordinate_systems/">Coordinate Systems</a></li><li><a class="tocitem" href="../texts/">Texts</a></li><li><a class="tocitem" href="../paths/">Paths</a></li><li><a class="tocitem" href="../routes/">Routes</a></li><li><a class="tocitem" href="../shapes/">Shape library</a></li><li><a class="tocitem" href="../autofill/">Autofill</a></li><li><a class="tocitem" href="../render/">Rendering</a></li><li><a class="tocitem" href="../solidmodels/">Solid Models (3D Geometry)</a></li><li><a class="tocitem" href="../fileio/">File Formats</a></li><li><a class="tocitem" href="../faq/">Troubleshooting/FAQ</a></li></ul></li><li><span class="tocitem">Schematic-Driven Layout</span><ul><li><a class="tocitem" href="../schematicdriven/">Overview</a></li><li><a class="tocitem" href="../schematicdriven/components/">Components</a></li><li><a class="tocitem" href="../schematicdriven/hooks/">Hooks</a></li><li><a class="tocitem" href="../schematicdriven/schematics/">Schematics</a></li><li><a class="tocitem" href="../schematicdriven/technologies/">Technologies</a></li><li><a class="tocitem" href="../schematicdriven/targets/">Targets</a></li><li><a class="tocitem" href="../schematicdriven/solidmodels/">Solid Models</a></li><li><a class="tocitem" href="../schematicdriven/pdks/">PDKs</a></li><li><a class="tocitem" href="../schematicdriven/faq/">Troubleshooting/FAQ</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/examplepdk/">ExamplePDK</a></li><li><a class="tocitem" href="../examples/qpu17/">Quantum Processor</a></li><li><a class="tocitem" href="../examples/singletransmon/">Single-Transmon Simulation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Geometry-Level Layout</a></li><li class="is-active"><a href>Geometry</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Geometry</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/aws-cqc/DeviceLayout.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/main/docs/src/geometry.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="AbstractGeometry"><a class="docs-heading-anchor" href="#AbstractGeometry">AbstractGeometry</a><a id="AbstractGeometry-1"></a><a class="docs-heading-anchor-permalink" href="#AbstractGeometry" title="Permalink"></a></h1><p>Any <code>AbstractGeometry</code> subtype will have a bounding box and associated methods. It will also support the <a href="../transformations/">transformation interface</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.AbstractGeometry" href="#DeviceLayout.AbstractGeometry"><code>DeviceLayout.AbstractGeometry</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractGeometry{S &lt;: Coordinate}</code></pre><p>Abstract supertype for things that have a geometric representation.</p><p>Abstract subtypes include <code>GeometryStructure</code>, <code>GeometryEntity</code>, and <code>GeometryReference</code>. Provides an interface for coordinate transformations and bounding boxes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/DeviceLayout.jl#L174-L182">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.coordinatetype" href="#DeviceLayout.coordinatetype"><code>DeviceLayout.coordinatetype</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">coordinatetype(::Type{S}) where {T, S &lt;: AbstractGeometry{T}}
coordinatetype(S) where {T, S &lt;: AbstractGeometry{T}}</code></pre><p>Return the coordinate type of the geometry.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/DeviceLayout.jl#L185-L190">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.bounds-Tuple{DeviceLayout.AbstractGeometry}" href="#DeviceLayout.bounds-Tuple{DeviceLayout.AbstractGeometry}"><code>DeviceLayout.bounds</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">bounds(geo::AbstractGeometry)
bounds(geo0::AbstractGeometry, geo1::AbstractGeometry, geo::AbstractGeometry...)
bounds(geos)</code></pre><p>Return the minimum bounding <code>Rectangle</code> for <code>geo</code> or a collection/iterator <code>geos</code>.</p><p>If <code>geo</code> is empty or has no extent, a rectangle with zero width and height is returned.</p><p>For a collection or a structure that may contain multiple entities and references to other structures, geometries with bounds having zero width and height are excluded from the calculation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/entities.jl#L61-L72">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.center" href="#DeviceLayout.center"><code>DeviceLayout.center</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">center(p::Polygon)</code></pre><p>Return the center of a polygon&#39;s bounding box (<code>Point</code> object). Note that this point doesn&#39;t have to be in the polygon.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/polygons.jl#L435-L440">source</a></section><section><div><pre><code class="language-julia hljs">center(geo::AbstractGeometry)
center(geos)</code></pre><p>Return the center of the bounding rectangle <a href="#DeviceLayout.bounds-Tuple{DeviceLayout.AbstractGeometry}"><code>bounds(geo)</code></a> or <code>bounds(geos)</code>.</p><p>Will not throw an <code>InexactError</code> even if <code>geo</code> has integer coordinates, but instead return floating point coordinates.</p><p>See also: <a href="#DeviceLayout.Points.lowerleft"><code>lowerleft</code></a>, <a href="#DeviceLayout.Points.upperright"><code>upperright</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/entities.jl#L89-L99">source</a></section><section><div><pre><code class="language-julia hljs">center(sch::Schematic, node::ComponentNode)
center(sch::Schematic, node_idx::Int)</code></pre><p>The center of the <code>bounds</code> of <code>node</code>&#39;s component in the global coordinate system of <code>sch</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L684-L689">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Points.lowerleft" href="#DeviceLayout.Points.lowerleft"><code>DeviceLayout.Points.lowerleft</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lowerleft(x::Polygon)</code></pre><p>Return the lower-left-most corner of a rectangle bounding polygon <code>x</code>. Note that this point doesn&#39;t have to be in the polygon.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/polygons.jl#L417-L422">source</a></section><section><div><pre><code class="language-julia hljs">lowerleft{T}(A::AbstractArray{Point{T}})</code></pre><p>Return the lower-left <a href="../points/#DeviceLayout.Points.Point"><code>Point</code></a> of the smallest bounding rectangle (with sides parallel to the x- and y-axes) that contains all points in <code>A</code>.</p><p>Example:</p><pre><code class="language-julia-repl hljs">julia&gt; lowerleft([Point(2, 0), Point(1, 1), Point(0, 2), Point(-1, 3)])
2-element Point{Int64} with indices SOneTo(2):
 -1
  0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/points.jl#L90-L104">source</a></section><section><div><pre><code class="language-julia hljs">lowerleft(r::Rectangle)</code></pre><p>Return the lower-left corner of a rectangle (Point object).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/rectangles.jl#L107-L111">source</a></section><section><div><pre><code class="language-julia hljs">lowerleft(ent::AbstractGeometry)
lowerleft(ents)</code></pre><p>Return the lower-left-most corner of a rectangle bounding <code>ent</code> or <code>ents</code>. Note that this point doesn&#39;t have to be in <code>ent</code>.</p><p>For iterable <code>ents</code>, entities with bounding rectanges of zero width and height will be excluded.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/entities.jl#L234-L243">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Points.upperright" href="#DeviceLayout.Points.upperright"><code>DeviceLayout.Points.upperright</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">upperright(x::Polygon)</code></pre><p>Return the upper-right-most corner of a rectangle bounding polygon <code>x</code>. Note that this point doesn&#39;t have to be in the polygon.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/polygons.jl#L425-L430">source</a></section><section><div><pre><code class="language-julia hljs">upperright{T}(A::AbstractArray{Point{T}})</code></pre><p>Return the upper-right <a href="../points/#DeviceLayout.Points.Point"><code>Point</code></a> of the smallest bounding rectangle (with sides parallel to the x- and y-axes) that contains all points in <code>A</code>.</p><p>Example:</p><pre><code class="language-julia-repl hljs">julia&gt; upperright([Point(2, 0), Point(1, 1), Point(0, 2), Point(-1, 3)])
2-element Point{Int64} with indices SOneTo(2):
 2
 3</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/points.jl#L112-L126">source</a></section><section><div><pre><code class="language-julia hljs">upperright(r::Rectangle)</code></pre><p>Return the upper-right corner of a rectangle (Point object).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/rectangles.jl#L114-L118">source</a></section><section><div><pre><code class="language-julia hljs">upperright(ent::AbstractGeometry)
upperright(ents)</code></pre><p>Return the upper-right-most corner of a rectangle bounding <code>ent</code> or <code>ents</code>. Note that this point doesn&#39;t have to be in <code>ent</code>.</p><p>For iterable <code>ents</code>, entities with bounding rectanges of zero width and height will be excluded.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/entities.jl#L255-L264">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.footprint" href="#DeviceLayout.footprint"><code>DeviceLayout.footprint</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">footprint(geo::AbstractGeometry)
footprint(geos)</code></pre><p>Return the footprint of <code>geo</code>.</p><p>By default, this falls back to <a href="#DeviceLayout.bounds-Tuple{DeviceLayout.AbstractGeometry}"><code>bounds(geo)</code></a>, but it may be any single <code>GeometryEntity</code> fully containing <code>geo</code>.</p><p>The footprint of a collection or iterator <code>geos</code> is <code>bounds(geos)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/entities.jl#L102-L112">source</a></section></article><p>There are three important subtypes of <code>AbstractGeometry</code>: <code>GeometryEntity</code>, <code>GeometryStructure</code>, and <code>GeometryReference</code>.</p><h2 id="Entities"><a class="docs-heading-anchor" href="#Entities">Entities</a><a id="Entities-1"></a><a class="docs-heading-anchor-permalink" href="#Entities" title="Permalink"></a></h2><p>Entities are &quot;simple&quot; geometric elements. An entity can be placed in a single layer and rendered to an output model. For example, rendering a <code>Rectangle</code> to a <code>Cell</code> creates a <code>Polygon</code> representation suitable for the GDSII format.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.GeometryEntity" href="#DeviceLayout.GeometryEntity"><code>DeviceLayout.GeometryEntity</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">GeometryEntity{T &lt;: Coordinate}</code></pre><p>A geometric entity that can be placed in a coordinate system.</p><p>New concrete <code>GeometryEntity</code> subtypes must implement the following:</p><pre><code class="language-julia hljs">to_polygons(::MyEntity)
transform(ent::MyEntity, f)</code></pre><p>A subtype may also implement specialized transformations like <code>transform(::MyEntity, ::ScaledIsometry)</code>, for example if special handling is possible for angle-preserving transformations, as well as specializations for</p><pre><code class="nohighlight hljs">magnify
rotate
rotate90
reflect_across_xaxis
translate</code></pre><p>which otherwise construct the corresponding <code>ScaledIsometry</code> and call <code>transform</code>.</p><p>New subtypes may also implement</p><pre><code class="language-julia hljs">footprint
halo
lowerleft
upperright</code></pre><p>if there are better ways to calculate these than with <code>to_polygons</code> (the default), which may be slow and expensive. The bounding rectangle returned by <code>bounds</code> is derived from <code>lowerleft</code> and <code>upperright</code>. By default, <code>halo</code> is derived from <code>footprint</code> and <code>offset</code>.</p><p>New subtypes may also implement any application functions required for valid styles. Not all styles need be valid for any given entity type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/entities.jl#L1-L44">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.to_polygons" href="#DeviceLayout.to_polygons"><code>DeviceLayout.to_polygons</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">to_polygons(ent::GeometryEntity; kwargs...)</code></pre><p>Return a single polygon, an iterator, or <code>Vector</code> of <code>Polygon</code>s equivalent to <code>ent</code>.</p><p>If <code>ent</code> is a <code>StyledEntity</code>, all styles will be applied before conversion to polygons.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/entities.jl#L169-L175">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.halo-Tuple{GeometryEntity, Any, Any}" href="#DeviceLayout.halo-Tuple{GeometryEntity, Any, Any}"><code>DeviceLayout.halo</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">halo(ent::GeometryEntity{T}, outer_delta, inner_delta=nothing)</code></pre><p>Return the &quot;halo&quot; of <code>ent</code> using an offset of <code>outer_delta</code>.</p><p>By default, the halo is a vector containing <a href="../polygons/#DeviceLayout.offset"><code>offset(footprint(ent), outer_delta)</code></a>, but it may contain any number of <code>GeometryEntity</code>s that together fully cover <code>ent</code> with a margin of <code>outer_delta</code>. It is not guaranteed to cover <a href="#DeviceLayout.footprint"><code>footprint(ent)</code></a>.</p><p>If <code>inner_delta</code> is provided, then the offset at <code>inner_delta</code> is subtracted from the result.</p><p>A <code>GeometryEntity</code> should implement a specialized <code>halo</code> if there is an efficient non-<code>Polygon</code> representation of the halo. If it does not, then by default <code>offset</code> will be used, which first resolves the entity into <code>Polygon</code>s using <code>to_polygons</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/entities.jl#L142-L157">source</a></section></article><p>Entity subtypes include <a href="../polygons/"><code>AbstractPolygon</code></a> (<code>Polygon</code> and <code>Rectangle</code>) and the individual pieces (&quot;nodes&quot;) of a <a href="../paths/"><code>Path</code></a>.</p><h2 id="Structures"><a class="docs-heading-anchor" href="#Structures">Structures</a><a id="Structures-1"></a><a class="docs-heading-anchor-permalink" href="#Structures" title="Permalink"></a></h2><p>Structures are &quot;composite&quot; geometric objects, containing any number of <code>GeometryEntity</code> elements and their metadata, accessed with the <code>elements</code> and <code>element_metadata</code> methods. They can also contain references to other structures, accessed with <code>refs</code>. Structures also have a <code>name</code> can be <code>flatten</code>ed. Metadata can be recursively changed in-place with <code>map_metadata!</code> or in a copy with <code>map_metadata</code>. The type parameter of a <code>GeometryStructure</code> determines the coordinate type of its elements.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.GeometryStructure" href="#DeviceLayout.GeometryStructure"><code>DeviceLayout.GeometryStructure</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">abstract type GeometryStructure{S} &lt;: AbstractGeometry{S}</code></pre><p>Supertype for structures that may contain entities and references to other structures.</p><p>Subtypes include <a href="../coordinate_systems/#DeviceLayout.AbstractCoordinateSystem"><code>DeviceLayout.AbstractCoordinateSystem</code></a> and <a href="../paths/#DeviceLayout.Paths.Path"><code>Path</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/DeviceLayout.jl#L217-L223">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.elements-Tuple{DeviceLayout.GeometryStructure}" href="#DeviceLayout.elements-Tuple{DeviceLayout.GeometryStructure}"><code>DeviceLayout.elements</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">elements(s::GeometryStructure)</code></pre><p>Return a vector of <code>GeometryEntity</code> in the structure.</p><p>For a <code>Cell</code>, these are <code>Polygon</code>s. For a <code>CoordinateSystem</code>, these can be any <code>GeometryEntity</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L96-L102">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.elementtype-Tuple{DeviceLayout.GeometryStructure}" href="#DeviceLayout.elementtype-Tuple{DeviceLayout.GeometryStructure}"><code>DeviceLayout.elementtype</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">elementtype(cs::GeometryStructure)</code></pre><p>Return the type of elements in the structure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L105-L109">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.element_metadata-Tuple{DeviceLayout.GeometryStructure}" href="#DeviceLayout.element_metadata-Tuple{DeviceLayout.GeometryStructure}"><code>DeviceLayout.element_metadata</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">element_metadata(s::GeometryStructure)</code></pre><p>Return a vector of metadata associated one-to-one with <code>elements(s)</code> in the structure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L89-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.map_metadata" href="#DeviceLayout.map_metadata"><code>DeviceLayout.map_metadata</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">function map_metadata(geom::GeometryStructure, map_meta)</code></pre><p>Create a copy of <code>geom</code> and change original metadata <code>m</code> to <code>map_meta(m)</code> for all elements.</p><p>Recursive on the copies of referenced structures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L182-L188">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.map_metadata!" href="#DeviceLayout.map_metadata!"><code>DeviceLayout.map_metadata!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">function map_metadata!(geom::GeometryStructure, map_meta)</code></pre><p>For every element in <code>geom</code> with original meta <code>m</code>, set its metadata to <code>map_meta(m)</code>.</p><p>Recursive on referenced structures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L170-L176">source</a></section><section><div><pre><code class="language-julia hljs">function map_metadata(comp::AbstractComponent, map_meta)</code></pre><p>For every element in <code>geometry(comp)</code> with original meta <code>m</code>, set its metadata to <code>map_meta(m)</code>.</p><p>Recursive on referenced structures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/targets.jl#L97-L103">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.name-Tuple{DeviceLayout.GeometryStructure}" href="#DeviceLayout.name-Tuple{DeviceLayout.GeometryStructure}"><code>DeviceLayout.name</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">name(s::GeometryStructure)</code></pre><p>Return a name <code>String</code> for <code>s</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L82-L86">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.refs-Tuple{DeviceLayout.GeometryStructure}" href="#DeviceLayout.refs-Tuple{DeviceLayout.GeometryStructure}"><code>DeviceLayout.refs</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">refs(s::GeometryStructure)</code></pre><p>Return a vector of references to sub-structures.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L112-L116">source</a></section></article><h3 id="Unique-names"><a class="docs-heading-anchor" href="#Unique-names">Unique names</a><a id="Unique-names-1"></a><a class="docs-heading-anchor-permalink" href="#Unique-names" title="Permalink"></a></h3><p>It&#39;s generally desirable to give unique names to structures. In particular, the GDSII format references cells by name, leading to errors or undefined behavior if different cells have the same name. The <code>uniquename</code> function makes it possible to ensure unique names on a per-Julia-session basis or until <code>reset_uniquename!</code> resets the name counter. Structures that are not constructed directly by the user will generally have names generated by <code>uniquename</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.uniquename" href="#DeviceLayout.uniquename"><code>DeviceLayout.uniquename</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">uniquename(str, dlm=&quot;\$&quot;; modify_first=false, counter=GLOBAL_NAME_COUNTER)</code></pre><p>Given string input <code>str</code> for the <code>n</code>th time, return <code>str * dlm * string(n)</code>.</p><p>If <code>str</code> is already formatted as <code>str0 * dlm * n</code>, where <code>n</code> is an integer, then <code>str0</code> will be used with the larger of <code>n</code> and the number of times <code>str0</code> has been counted plus one.</p><p>If <code>modify_first</code> is <code>false</code>, then <code>str</code> will be returned the first time <code>uniquename(str, dlm; modify_first=false)</code> is called.</p><p>Useful if programmatically making Cells and all of them will eventually be saved into a GDSII file.</p><p>The uniqueness is expected on a per-Julia session basis or until <a href="#DeviceLayout.reset_uniquename!"><code>reset_uniquename!</code></a> is called, so if you load an existing GDSII file and try to save unique cells on top of that you may get an unlucky clash. Calling <code>uniquename</code> on all loaded <code>Cell</code> names will effectively &quot;register&quot; them, making subsequent <code>uniquename</code> calls aware of them.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; reset_uniquename!();

julia&gt; uniquename(&quot;name&quot;; modify_first=true)
&quot;name\$1&quot;

julia&gt; uniquename(&quot;name\$4&quot;)
&quot;name\$4&quot;

julia&gt; uniquename(&quot;name\$3&quot;)
&quot;name\$5&quot;

julia&gt; uniquename(&quot;name&quot;)
&quot;name\$6&quot;</code></pre><p><code>counter</code> is the <code>Dict{String,Int}</code> that counts how many times each name has been seen. The default is a global counter that persists until the end of the Julia session or until <a href="#DeviceLayout.reset_uniquename!"><code>reset_uniquename!</code></a> is called.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L3-L43">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.reset_uniquename!" href="#DeviceLayout.reset_uniquename!"><code>DeviceLayout.reset_uniquename!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reset_uniquename!(counter=GLOBAL_NAME_COUNTER)</code></pre><p>Reset <a href="#DeviceLayout.uniquename"><code>uniquename</code></a> counters for all strings.</p><p><code>counter</code> is the <code>Dict{String,Int}</code> that counts how many times each name has been seen. The default is the same default global counter used by <code>uniquename</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L62-L69">source</a></section><section><div><pre><code class="language-julia hljs">reset_uniquename!(str::String, counter=GLOBAL_NAME_COUNTER)</code></pre><p>Reset <a href="#DeviceLayout.uniquename"><code>uniquename</code></a> counter for <code>str</code>.</p><p><code>counter</code> is the <code>Dict{String,Int}</code> that counts how many times each name has been seen. The default is the same default global counter used by <code>uniquename</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/structures.jl#L72-L79">source</a></section></article><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>References point to a <code>structure</code> together with a <code>transformation</code> that positions it relative to the structure holding the reference. An <code>ArrayReference</code> also contains parameters specifying a 2d grid of instantiations of the referenced structure. The methods <code>sref</code> and <code>aref</code> are convenient for creating <code>StructureReference</code>s and <code>ArrayReference</code>s, respectively.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.GeometryReference" href="#DeviceLayout.GeometryReference"><code>DeviceLayout.GeometryReference</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">GeometryReference{S&lt;:Coordinate, T&lt;:GeometryStructure} &lt;: AbstractGeometry{S}</code></pre><p>Abstract supertype for references to geometry structures.</p><p>Subtypes are <code>StructureReference</code> and <code>ArrayReference</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/DeviceLayout.jl#L291-L297">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.StructureReference" href="#DeviceLayout.StructureReference"><code>DeviceLayout.StructureReference</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mutable struct StructureReference{S, T} &lt;: GeometryReference{S, T}
    structure::T
    origin::Point{S}
    xrefl::Bool
    mag::Float64
    rot::Float64
end</code></pre><p>Reference to a <code>structure</code> positioned at <code>origin</code>, with optional x-reflection <code>xrefl</code>, magnification factor <code>mag</code>, and rotation angle <code>rot</code>. If an angle is given without units it is assumed to be in radians.</p><p>That is, the transformation applied by the reference is the composition of the following transformations, ordered with reflection applied first:</p><ol><li>If <code>xrefl(f)</code> is <code>true</code>, a reflection across the <code>x</code>-axis</li><li>Rotation by <code>rotation(f)</code></li><li>Magnification by <code>mag(f)</code></li><li>Translation by <code>origin(f)</code></li></ol><p>The type variable <code>T</code> is to avoid circular definitions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L1-L23">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.ArrayReference" href="#DeviceLayout.ArrayReference"><code>DeviceLayout.ArrayReference</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mutable struct ArrayReference{S,T} &lt;: GeometryReference{S,T}
    structure::T
    origin::Point{S}
    deltacol::Point{S}
    deltarow::Point{S}
    col::Int
    row::Int
    xrefl::Bool
    mag::Float64
    rot::Float64
end</code></pre><p>Array of <code>structure</code> starting at <code>origin</code> with <code>row</code> rows and <code>col</code> columns, spanned by vectors <code>deltacol</code> and <code>deltarow</code>. Optional x-reflection <code>xrefl</code>, magnification factor <code>mag</code>, and rotation angle <code>rot</code> for the array as a whole. If an angle is given without units it is assumed to be in radians.</p><p>The type variable <code>T</code> is to avoid circular definitions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L75-L94">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.copy-Tuple{DeviceLayout.GeometryReference}" href="#Base.copy-Tuple{DeviceLayout.GeometryReference}"><code>Base.copy</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">copy(x::GeometryReference)</code></pre><p>Creates a shallow copy of <code>x</code> (does not copy the referenced structure).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L217-L221">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.aref" href="#DeviceLayout.aref"><code>DeviceLayout.aref</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">aref(x::GeometryStructure{S}, origin::Point{T}=zero(Point{S}); kwargs...) where
    {S &lt;: Coordinate, T &lt;: Coordinate}</code></pre><p>Construct a <code>ArrayReference{float(T),typeof(x)}</code> object.</p><p>Keyword arguments specify the column vector, row vector, number of columns, number of rows, x-reflection, magnification factor, and rotation.</p><p>Synonyms are accepted for these keywords:</p><ul><li>Column vector <code>dc::Point{T}</code>: <code>:deltacol</code>, <code>:dcol</code>, <code>:dc</code>, <code>:vcol</code>, <code>:colv</code>, <code>:colvec</code>, <code>:colvector</code>, <code>:columnv</code>, <code>:columnvec</code>, <code>:columnvector</code></li><li>Row vector: <code>:deltarow</code>, <code>:drow</code>, <code>:dr</code>, <code>:vrow</code>, <code>:rv</code>, <code>:rowvec</code>, <code>:rowvector</code></li><li>Number of columns: <code>:nc</code>, <code>:numcols</code>, <code>:numcol</code>, <code>:ncols</code>, <code>:ncol</code></li><li>Number of rows: <code>:nr</code>, <code>:numrows</code>, <code>:numrow</code>, <code>:nrows</code>, <code>:nrow</code></li><li>X-reflection: <code>:xrefl</code>, <code>:xreflection</code>, <code>:refl</code>, <code>:reflect</code>, <code>:xreflect</code>, <code>:xmirror</code>, <code>:mirror</code></li><li>Magnification: <code>:mag</code>, <code>:magnification</code>, <code>:magnify</code>, <code>:zoom</code>, <code>:scale</code></li><li>Rotation: <code>:rot</code>, <code>:rotation</code>, <code>:rotate</code>, <code>:angle</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L465-L486">source</a></section><section><div><pre><code class="language-julia hljs">aref(x, c::AbstractRange, r::AbstractRange; kwargs...)</code></pre><p>Construct an <code>ArrayReference</code> based on ranges (probably <code>LinSpace</code> or <code>FloatRange</code>). <code>c</code> specifies column coordinates and <code>r</code> for the rows. Pairs from <code>c</code> and <code>r</code> specify the origins of the repeated cells. The extrema of the ranges therefore do not specify the extrema of the resulting <code>ArrayReference</code>&#39;s bounding box; some care is required.</p><p>Keyword arguments specify x-reflection, magnification factor, and rotation, with synonyms allowed:</p><ul><li>X-reflection: <code>:xrefl</code>, <code>:xreflection</code>, <code>:refl</code>, <code>:reflect</code>, <code>:xreflect</code>, <code>:xmirror</code>, <code>:mirror</code></li><li>Magnification: <code>:mag</code>, <code>:magnification</code>, <code>:magnify</code>, <code>:zoom</code>, <code>:scale</code></li><li>Rotation: <code>:rot</code>, <code>:rotation</code>, <code>:rotate</code>, <code>:angle</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L505-L521">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.sref" href="#DeviceLayout.sref"><code>DeviceLayout.sref</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sref(x::GeometryStructure{T}, origin=zero(Point{T}); kwargs...)</code></pre><p>Convenience constructor for <code>StructureReference{float(T), typeof(x)}</code>.</p><p>Synonyms are accepted for these keywords:</p><pre><code class="nohighlight hljs">- X-reflection: `:xrefl`, `:xreflection`, `:refl`, `:reflect`, `:xreflect`,
`:xmirror`, `:mirror`
- Magnification: `:mag`, `:magnification`, `:magnify`, `:zoom`, `:scale`
- Rotation: `:rot`, `:rotation`, `:rotate`, `:angle`</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L402-L413">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.structure" href="#DeviceLayout.structure"><code>DeviceLayout.structure</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">structure(ref::GeometryReference)</code></pre><p>The <code>GeometryStructure</code> that <code>ref</code> points to.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L165-L169">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.transformation-Tuple{DeviceLayout.GeometryReference}" href="#DeviceLayout.transformation-Tuple{DeviceLayout.GeometryReference}"><code>DeviceLayout.transformation</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">transformation(c::GeometryReference)</code></pre><p>Return the angle-preserving transformation to be applied to the referenced structure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L225-L229">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Transformations.origin-Tuple{DeviceLayout.GeometryReference}" href="#DeviceLayout.Transformations.origin-Tuple{DeviceLayout.GeometryReference}"><code>DeviceLayout.Transformations.origin</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">origin(ref::GeometryReference)</code></pre><p>The origin of the structure that <code>ref</code> points to, in <code>ref</code>&#39;s parent coordinate system.</p><p>Equivalently, the translation part of <code>transformation(ref)</code> (the transformation that <code>ref</code> would apply to <code>structure(ref)</code>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L172-L179">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Transformations.mag-Tuple{DeviceLayout.GeometryReference}" href="#DeviceLayout.Transformations.mag-Tuple{DeviceLayout.GeometryReference}"><code>DeviceLayout.Transformations.mag</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mag(ref::GeometryReference)</code></pre><p>The magnification (uniform scaling factor) applied by <code>transformation(ref)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L189-L193">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Transformations.rotation-Tuple{DeviceLayout.GeometryReference}" href="#DeviceLayout.Transformations.rotation-Tuple{DeviceLayout.GeometryReference}"><code>DeviceLayout.Transformations.rotation</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rotation(ref::GeometryReference; α0=0)</code></pre><p>The change in angle when applying <code>transformation(ref)</code> to a line originally at <code>α0</code> CCW from the <code>x</code>-axis.</p><p>Equivalent to <code>rotation(transformation(ref); α0=α0)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L196-L202">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Transformations.xrefl-Tuple{DeviceLayout.GeometryReference}" href="#DeviceLayout.Transformations.xrefl-Tuple{DeviceLayout.GeometryReference}"><code>DeviceLayout.Transformations.xrefl</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">xrefl(ref::GeometryReference)</code></pre><p>A <code>Bool</code> indicating whether <code>transformation(ref)</code> includes a reflection.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L182-L186">source</a></section></article><h3 id="Resolving-references"><a class="docs-heading-anchor" href="#Resolving-references">Resolving references</a><a id="Resolving-references-1"></a><a class="docs-heading-anchor-permalink" href="#Resolving-references" title="Permalink"></a></h3><p>Sometimes it can be helpful to transform between coordinate systems and the coordinate systems they reference. This package provides methods to generate affine transforms to do this as easily as possible.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.transformation-Tuple{DeviceLayout.GeometryStructure, DeviceLayout.GeometryReference}" href="#DeviceLayout.transformation-Tuple{DeviceLayout.GeometryStructure, DeviceLayout.GeometryReference}"><code>DeviceLayout.transformation</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">transformation(c::GeometryStructure, d::GeometryReference)</code></pre><p>Given a GeometryStructure <code>c</code> containing <a href="#DeviceLayout.GeometryReference"><code>GeometryReference</code></a> <code>d</code> in its tree of references, this function returns a <code>Transformations.ScaledIsometry</code> object that lets you translate from the coordinate system of <code>d</code> to the coordinate system of <code>c</code>.</p><p>If the <em>same exact</em> <code>GeometryReference</code> (as in <code>===</code>, same address in memory) is included multiple times in the tree of references, then the resulting transform will be based on the first time it is encountered. The tree is traversed one level at a time to find the reference (optimized for shallow references).</p><p>Example: You want to translate (2.0,3.0) in the coordinate system of the referenced coordinate system <code>d</code> to the coordinate system of <code>c</code>:</p><pre><code class="nohighlight hljs">julia&gt; trans = transformation(c,d)

julia&gt; trans(Point(2.0,3.0))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L249-L271">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.transformation-Tuple{DeviceLayout.GeometryStructure, DeviceLayout.GeometryReference, DeviceLayout.GeometryReference, Vararg{DeviceLayout.GeometryReference}}" href="#DeviceLayout.transformation-Tuple{DeviceLayout.GeometryStructure, DeviceLayout.GeometryReference, DeviceLayout.GeometryReference, Vararg{DeviceLayout.GeometryReference}}"><code>DeviceLayout.transformation</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">transformation(c::GeometryStructure, d::GeometryReference, e::GeometryReference, f::GeometryReference...)</code></pre><p>Given a geometry structure <code>c</code> containing <a href="#DeviceLayout.GeometryReference"><code>GeometryReference</code></a> <code>last(f)</code> in its tree of references, this function returns a <code>Transformations.ScaledIsometry</code> object that lets you translate from the coordinate system of <code>last(f)</code> to the coordinate system of <code>c</code>. This method is needed when you want to specify intermediate <code>GeometryReference</code>s explicitly.</p><p>For example, suppose for instance you have a hierarchy of coordinate systems, where coordinate system A references B1 and B2, which both reference C. Schematically, it might look like this:</p><pre><code class="nohighlight hljs">a -- b1 -- c
  \      /
   \ b2 /</code></pre><p>Coordinate system C appears in two places inside coordinate system A, owing to the fact that it is referenced by both B1 and B2. If you need to get the coordinate system of C via B2, then you need to do <code>transformation(coordinatesystemA, coordsysrefB2, coordsysrefC)</code>, rather than simply <code>transform(coordinatesystemA, coordsysrefC)</code>, because the latter will just take the first path to C available, via B1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L301-L323">source</a></section></article><h3 id="Flattening"><a class="docs-heading-anchor" href="#Flattening">Flattening</a><a id="Flattening-1"></a><a class="docs-heading-anchor-permalink" href="#Flattening" title="Permalink"></a></h3><p>Sometimes it&#39;s also helpful use an operation called &quot;flattening&quot; to produce an equivalent coordinate system with no references—that is, with all its elements at the top level.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.flatten-Tuple{DeviceLayout.GeometryStructure}" href="#DeviceLayout.flatten-Tuple{DeviceLayout.GeometryStructure}"><code>DeviceLayout.flatten</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">flatten(c::GeometryStructure; depth::Integer=-1, name=uniquename(&quot;flatten_&quot;*name(c)))</code></pre><p>Return a new coordinate system with name <code>name</code> with recursively flattened references and arrays up to a hierarchical <code>depth</code>.</p><p>Flattening a <code>CoordinateSystem</code> or <code>Cell</code> produces a coordinate system of the same type (meaning these can also be flattened in-place with <a href="../coordinate_systems/#DeviceLayout.CoordinateSystems.flatten!-Tuple{DeviceLayout.AbstractCoordinateSystem}"><code>flatten!</code></a>), while flattening other structures generally produces a <code>CoordinateSystem</code> with the same coordinate type.</p><p>Flattening adds the elements of references to the top-level structure with appropriate transformations, then discards those references. Deeper references and arrays are brought upwards and are not discarded.</p><p>This function has no effect on references for <code>depth == 0</code>, and unlimited depth by default.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/coordsys_interface.jl#L182-L196">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.flatten-Tuple{DeviceLayout.GeometryReference}" href="#DeviceLayout.flatten-Tuple{DeviceLayout.GeometryReference}"><code>DeviceLayout.flatten</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">flatten(c::GeometryReference; depth::Integer=-1, name=uniquename(&quot;flatten_&quot;*name(structure(c))), metadata_filter=nothing)</code></pre><p>Return a new structure with name <code>name</code> with recursively flattened references and arrays up to a hierarchical <code>depth</code>.</p><p>Flattening adds the elements of references to the top-level coordinate system with appropriate transformations, then discards those references. Deeper references and arrays are brought upwards and are not discarded. If <code>depth=0</code>, a new coordinate system is returned containing only the reference.</p><p><code>metadata_filter</code> can be a function that takes a <code>DeviceLayout.Meta</code> and returns a <code>Bool</code>, like a function returned by <a href="#DeviceLayout.layer_inclusion"><code>layer_inclusion</code></a>. In that case, only elements whose metadata <code>m</code> have <code>metadata_filter(m) == true</code> will be retained while flattening. Elements of deeper references and arrays are not filtered.</p><p>The reference <code>c</code> remains unmodified.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L343-L359">source</a></section></article><p>These methods take a <code>metadata_filter</code> keyword argument, which is a function that can be generated using <code>layer_inclusion</code> and lists of layers to include or ignore:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.layer_inclusion" href="#DeviceLayout.layer_inclusion"><code>DeviceLayout.layer_inclusion</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">layer_inclusion(only_layers, ignore_layers)</code></pre><p>Return a function <code>f(m::Meta)</code> that returns a <code>Bool</code> based on inclusion/exclusion rules.</p><p>Both <code>only_layers</code> and <code>ignore_layers</code> are  <code>DeviceLayout.Meta</code>, layer name <code>Symbol</code>s, and/or collections of either.</p><p>If <code>only_layers</code> is empty, then only <code>ignore_layers</code> is used, and <code>f(m)</code> checks that neither <code>m</code> nor <code>layer(m)</code> is in <code>ignore_layers</code>. Otherwise, <code>f(m)</code> also checks that <code>m</code> or <code>layer(m)</code> is in <code>only_layers</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/metadata.jl#L120-L129">source</a></section></article><p>For convenience, if you want to get just the list of elements in a flattened structure that match a layer or set of layers, you can use <code>flat_elements</code>:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.flat_elements" href="#DeviceLayout.flat_elements"><code>DeviceLayout.flat_elements</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">flat_elements(geom::Union{GeometryStructure,GeometryReference}, only_layers=[], ignore_layers=[])
flat_elements(geom_layer::Pair{&lt;:Union{GeometryStructure,GeometryReference}})</code></pre><p>Return a list of <code>GeometryEntity</code> elements in flatten(cs), optionally filtering metadata.</p><p><code>only_layers</code> and <code>ignore_layers</code> can be layer name <code>Symbol</code>s, <code>DeviceLayout.Meta</code>, or collections of either. The metadata filtering function is produced using <a href="#DeviceLayout.layer_inclusion"><code>layer_inclusion(only_layers, ignore_layers)</code></a>. This means that the default empty <code>only_layers</code> is the same as listing all layers.</p><p>Using an argument pair <code>geom =&gt; layer</code> is equivalent to <code>flat_elements(geom, layer)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L371-L382">source</a></section></article><h3 id="Indexing"><a class="docs-heading-anchor" href="#Indexing">Indexing</a><a id="Indexing-1"></a><a class="docs-heading-anchor-permalink" href="#Indexing" title="Permalink"></a></h3><p>For convenience, you can get referenced structures by indexing their parent with the structure name, as in <code>cs[&quot;referenced_cs&quot;][&quot;deeper_cs&quot;]</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.getindex-Tuple{DeviceLayout.GeometryStructure, AbstractString, Integer}" href="#Base.getindex-Tuple{DeviceLayout.GeometryStructure, AbstractString, Integer}"><code>Base.getindex</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">getindex(c::GeometryStructure, nom::AbstractString, index::Integer=1)</code></pre><p>If <code>c</code> references a structure with name <code>nom</code>, this method will return the corresponding <code>GeometryReference</code>. If there are several references to that coordinate system, then <code>index</code> specifies which one is returned (in the order they are found in <code>refs(c)</code>). e.g. to specify an index of 2: <code>myCS[&quot;myreferencedCS&quot;,2]</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L648-L655">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.getindex-Tuple{DeviceLayout.GeometryReference, AbstractString, Integer}" href="#Base.getindex-Tuple{DeviceLayout.GeometryReference, AbstractString, Integer}"><code>Base.getindex</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">getindex(c::GeometryReference, nom::AbstractString, index::Integer=1)</code></pre><p>If the structure referenced by <code>c</code> references a structure with name <code>nom</code>, this method will return the corresponding <code>GeometryReference</code>. If there are several references to that structure, then <code>index</code> specifies which one is returned (in the order they are found in <code>refs(structure(c))</code>).</p><p>This method is typically used so that we can type the first line instead of the second line in the following:</p><pre><code class="language-julia hljs">myCS[&quot;myreferencedCS&quot;][&quot;onedeeper&quot;]
myCS[&quot;myreferencedCS&quot;].structure[&quot;onedeeper&quot;]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/references.jl#L661-L676">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../points/">« Points</a><a class="docs-footer-nextpage" href="../transformations/">Transformations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Thursday 27 February 2025 13:39">Thursday 27 February 2025</span>. Using Julia version 1.10.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
