<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Schematics ¬∑ DeviceLayout.jl</title><meta name="title" content="Schematics ¬∑ DeviceLayout.jl"/><meta property="og:title" content="Schematics ¬∑ DeviceLayout.jl"/><meta property="twitter:title" content="Schematics ¬∑ DeviceLayout.jl"/><meta name="description" content="Documentation for DeviceLayout.jl."/><meta property="og:description" content="Documentation for DeviceLayout.jl."/><meta property="twitter:description" content="Documentation for DeviceLayout.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DeviceLayout.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Geometry-Level Layout</span><ul><li><a class="tocitem" href="../../geometrylevel/">Overview</a></li><li><a class="tocitem" href="../../units/">Units</a></li><li><a class="tocitem" href="../../points/">Points</a></li><li><a class="tocitem" href="../../geometry/">Geometry</a></li><li><a class="tocitem" href="../../transformations/">Transformations</a></li><li><a class="tocitem" href="../../entitystyles/">Entity Styles</a></li><li><a class="tocitem" href="../../polygons/">Polygons</a></li><li><a class="tocitem" href="../../coordinate_systems/">Coordinate Systems</a></li><li><a class="tocitem" href="../../texts/">Texts</a></li><li><a class="tocitem" href="../../paths/">Paths</a></li><li><a class="tocitem" href="../../routes/">Routes</a></li><li><a class="tocitem" href="../../shapes/">Shape library</a></li><li><a class="tocitem" href="../../autofill/">Autofill</a></li><li><a class="tocitem" href="../../render/">Rendering</a></li><li><a class="tocitem" href="../../solidmodels/">Solid Models (3D Geometry)</a></li><li><a class="tocitem" href="../../fileio/">File Formats</a></li><li><a class="tocitem" href="../../faq/">Troubleshooting/FAQ</a></li></ul></li><li><span class="tocitem">Schematic-Driven Layout</span><ul><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../components/">Components</a></li><li><a class="tocitem" href="../hooks/">Hooks</a></li><li class="is-active"><a class="tocitem" href>Schematics</a><ul class="internal"><li><a class="tocitem" href="#Schematic-graphs"><span>Schematic graphs</span></a></li><li><a class="tocitem" href="#Routing"><span>Routing</span></a></li><li><a class="tocitem" href="#Schematics-2"><span>Schematics</span></a></li><li><a class="tocitem" href="#Visualization"><span>Visualization</span></a></li></ul></li><li><a class="tocitem" href="../technologies/">Technologies</a></li><li><a class="tocitem" href="../targets/">Targets</a></li><li><a class="tocitem" href="../solidmodels/">Solid Models</a></li><li><a class="tocitem" href="../pdks/">PDKs</a></li><li><a class="tocitem" href="../faq/">Troubleshooting/FAQ</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/examplepdk/">ExamplePDK</a></li><li><a class="tocitem" href="../../examples/qpu17/">Quantum Processor</a></li><li><a class="tocitem" href="../../examples/singletransmon/">Single-Transmon Simulation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Schematic-Driven Layout</a></li><li class="is-active"><a href>Schematics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Schematics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/aws-cqc/DeviceLayout.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/main/docs/src/schematicdriven/schematics.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Schematics"><a class="docs-heading-anchor" href="#Schematics">Schematics</a><a id="Schematics-1"></a><a class="docs-heading-anchor-permalink" href="#Schematics" title="Permalink"></a></h1><h2 id="Schematic-graphs"><a class="docs-heading-anchor" href="#Schematic-graphs">Schematic graphs</a><a id="Schematic-graphs-1"></a><a class="docs-heading-anchor-permalink" href="#Schematic-graphs" title="Permalink"></a></h2><p>The schematic graph is a collection of logical information about the presence of components and their connections. Its nodes are <code>ComponentNode</code>s, representing instances of <code>AbstractComponent</code>s in the design. The edges are labeled with the names of the components&#39; <code>Hook</code>s that are to be fused together.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.SchematicGraph" href="#DeviceLayout.SchematicDrivenLayout.SchematicGraph"><code>DeviceLayout.SchematicDrivenLayout.SchematicGraph</code></a> ‚Äî <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SchematicGraph &lt;: AbstractMetaGraph{Int}</code></pre><p>Graph describing the components and connectivity of a device schematic.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L44-L48">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.ComponentNode" href="#DeviceLayout.SchematicDrivenLayout.ComponentNode"><code>DeviceLayout.SchematicDrivenLayout.ComponentNode</code></a> ‚Äî <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mutable struct ComponentNode
    id::String
    component::AbstractComponent
end</code></pre><p>Represents an instance of a component in the context of a schematic graph.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L19-L26">source</a></section></article><h3 id="Adding-and-connecting-Components"><a class="docs-heading-anchor" href="#Adding-and-connecting-Components">Adding and connecting Components</a><a id="Adding-and-connecting-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-and-connecting-Components" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.add_node!" href="#DeviceLayout.SchematicDrivenLayout.add_node!"><code>DeviceLayout.SchematicDrivenLayout.add_node!</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">add_node!(g::SchematicGraph, comp::AbstractComponent; base_id=name(comp), kwargs...)</code></pre><p>Create and return a new node for <code>comp</code>.</p><p>The <code>base_id</code> will be used as the node&#39;s <code>id</code> if it is not already in use by the <code>Schematic</code>. If it is, then a uniquename will be generated by appending <code>_n</code>, where <code>n</code> is the number of occurrences of <code>base_id</code> so far (including this one).</p><p>Additional keyword arguments will become vertex properties.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L137-L147">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.fuse!" href="#DeviceLayout.SchematicDrivenLayout.fuse!"><code>DeviceLayout.SchematicDrivenLayout.fuse!</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fuse!(g::SchematicGraph,
    nodehook1::Pair{Int, Symbol},
    nodehook2::Pair{Int, Symbol}; kwargs...)
fuse!(g::SchematicGraph,
    nodehook1::Pair{ComponentNode, &lt;:Union{Symbol, Hook}},
    nodehook2::Pair{&lt;:Union{ComponentNode, AbstractComponent}, &lt;:Union{Symbol, Hook}}; kwargs...)</code></pre><p>Usage:</p><ul><li><code>fuse!(g, node1=&gt;:hook1, node2=&gt;:hook2)</code></li><li><code>fuse!(g, idx1=&gt;:hook1, idx2=&gt;:hook2)</code></li><li><code>fuse!(g, node1=&gt;:hook1, comp2=&gt;:hook2)</code></li><li><code>fuse!(g, node1=&gt;:hook1, comp2=&gt;:hook2; PLAN_SKIPS_EDGE=&gt;true)</code></li></ul><p>Add an edge <code>(node1, node2)</code> connecting their hooks <code>(:hook1, :hook2)</code> to <code>g</code>.</p><p>Returns the second <code>ComponentNode</code>.</p><p>If <code>fuse!</code> is passed a bare component <code>comp2</code>, it makes a new node, even if that component is referenced in another node.</p><p>If no hook or only one hook is specified, <code>fuse!</code> will try to determine the correct hook using <code>matching_hooks</code> or <code>matching_hook</code>.</p><p>You can make an attachment anywhere, not just to an existing named hook, by providing a <code>Hook</code> object with the desired point and orientation rather than a <code>Symbol</code> (example: <code>fuse!(g, node1=&gt;PointHook(1mm, 1mm, 90¬∞), comp2=&gt;:hook2)</code>). This option is provided for convenience in situations that call for ad-hoc or case-by-case relative positioning; one example use case might be placing labels near components. On the other hand, if you find yourself needing a consistent hook that doesn&#39;t already exist for <code>MyComponent</code>, then it&#39;s generally better to update the component definition so that the hook is available through <code>hooks(::MyComponent)</code>. Alternatively, if you want to use an existing hook with an additional offset, consider using the <a href="../components/#DeviceLayout.SchematicDrivenLayout.Spacer"><code>Spacer</code></a> component.</p><p>Cycles: Sometimes we need to avoid adding edges in the graph to avoid cycles that&#39;d force the <code>plan</code> function to throw an error. Solution: Pass a keyword argument <code>plan_skips_edge=true</code>. This allows us to encode all the edges in the graph, while informing the <code>plan</code> function that the edge should be skipped for rendering purposes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L175-L215">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Paths.route!-Tuple{DeviceLayout.SchematicDrivenLayout.SchematicGraph, DeviceLayout.Paths.RouteRule, Pair{DeviceLayout.SchematicDrivenLayout.ComponentNode, Symbol}, Pair{DeviceLayout.SchematicDrivenLayout.ComponentNode, Symbol}, Any, Any}" href="#DeviceLayout.Paths.route!-Tuple{DeviceLayout.SchematicDrivenLayout.SchematicGraph, DeviceLayout.Paths.RouteRule, Pair{DeviceLayout.SchematicDrivenLayout.ComponentNode, Symbol}, Pair{DeviceLayout.SchematicDrivenLayout.ComponentNode, Symbol}, Any, Any}"><code>DeviceLayout.Paths.route!</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">route!(g::SchematicGraph, rule::RouteRule,
    nodehook1::Pair{ComponentNode,Symbol}, nodehook2::Pair{ComponentNode,Symbol},
    sty, meta;
    waypoints=[], waydirs=[], global_waypoints=false,
    name=uniquename(&quot;r_$(component(nodehook1.first).name)_$(component(nodehook2.first).name)&quot;),
    kwargs...)
route!(g::SchematicGraph, rule::RouteRule, node1::ComponentNode, nodehook2::Pair{ComponentNode,Symbol}, sty, meta; kwargs...)
route!(g::SchematicGraph, rule::RouteRule, nodehook1::Pair{ComponentNode,Symbol}, node2::ComponentNode, sty, meta; kwargs...)
route!(g::SchematicGraph, rule::RouteRule, node1::ComponentNode, node2::ComponentNode, sty, meta; kwargs...)</code></pre><p>Creates a <code>RouteComponent</code> with given style <code>sty</code> and metadata <code>meta</code>, and fuses it between the specified nodes and hooks in <code>g</code>.</p><p>Returns the resulting <code>ComponentNode</code> in <code>g</code>.</p><p>Example usage: <code>route!(g, BSplineRouting(), zline_node=&gt;:feedline, z_launcher_node=&gt;:line, Paths.CPW(10Œºm, 6Œºm), GDSMeta(1, 2))</code></p><p>If one or both hook symbols are not specified, then <code>matching_hook</code> or <code>matching_hooks</code> will be used to attempt to automatically find the correct hook or hooks.</p><p>The route will have start and endpoints at the origin until a method like <code>plan!</code> is called. <code>waypoints</code> and <code>waydirs</code> are in component-local coordinates (unless <code>global_waypoints</code> is <code>true</code>), and <code>rule</code> determines how they will be used.</p><p>Additional keyword arguments will become vertex properties for the <code>RouteComponent</code>&#39;s node.</p><p><code>name</code> should be unique.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/routes.jl#L136-L163">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.RouteComponent" href="#DeviceLayout.SchematicDrivenLayout.RouteComponent"><code>DeviceLayout.SchematicDrivenLayout.RouteComponent</code></a> ‚Äî <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct RouteComponent{T} &lt;: AbstractComponent{T}
    name::String
    r::Paths.Route{T}
    global_waypoints::Bool
    sty::Paths.Style
    meta::Meta</code></pre><p>Wraps a <code>Route</code> in a <code>Component</code> type for use with schematics.</p><p><code>name</code> should be unique. If <code>global_waypoints</code> is false, then the waypoints and waydirs are taken to be relative to the component coordinate system. Otherwise, they will be relative to the schematic global coordinate system.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/routes.jl#L10-L23">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Paths.attach!-Union{Tuple{T}, Tuple{S}, Tuple{DeviceLayout.SchematicDrivenLayout.SchematicGraph, S, Pair{T, Symbol}, Union{Real, Unitful.Level{L, S, Unitful.Quantity{T, ùêã, U}} where {T, U, L, S}, Unitful.Quantity{T, ùêã} where T}}} where {S&lt;:DeviceLayout.SchematicDrivenLayout.ComponentNode, T&lt;:DeviceLayout.SchematicDrivenLayout.ComponentNode}" href="#DeviceLayout.Paths.attach!-Union{Tuple{T}, Tuple{S}, Tuple{DeviceLayout.SchematicDrivenLayout.SchematicGraph, S, Pair{T, Symbol}, Union{Real, Unitful.Level{L, S, Unitful.Quantity{T, ùêã, U}} where {T, U, L, S}, Unitful.Quantity{T, ùêã} where T}}} where {S&lt;:DeviceLayout.SchematicDrivenLayout.ComponentNode, T&lt;:DeviceLayout.SchematicDrivenLayout.ComponentNode}"><code>DeviceLayout.Paths.attach!</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">attach!(g::SchematicGraph,
    pathnode::S,
    nodehook2::Pair{T, Symbol},
    position;
    i=lastindex(component(pathnode)),
    location=0) where {S &lt;: ComponentNode, T &lt;: ComponentNode}
Usage: attach!(g, pathnode, node2=&gt;:hook2, position; i=segment_idx, location=0)</code></pre><p>Adds an edge to <code>g</code> between <code>pathnode</code> and <code>node2</code>, attaching <code>:hook2</code> to a specified point along <code>pathnode</code>.</p><p>A new <code>HandedPointHook</code> is generated a distance <code>position</code> along the segment specified by <code>i</code>. If <code>location</code> is +1 or -1, the generated hook is offset to the right or left of the segment by the extent defined by the path&#39;s style, with the hook&#39;s inward direction pointing back to the segment.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L379-L393">source</a></section></article><h2 id="Routing"><a class="docs-heading-anchor" href="#Routing">Routing</a><a id="Routing-1"></a><a class="docs-heading-anchor-permalink" href="#Routing" title="Permalink"></a></h2><p>A <a href="../../routes/#DeviceLayout.Paths.Route"><code>Paths.Route</code></a> is like a <code>Path</code>, but defined implicitly in terms of its endpoints and rules (like &quot;use only straight sections and 90 degree turns&quot;) for getting from one end to another. We can add <code>Route</code>s between components in a schematic using <a href="../../routes/#DeviceLayout.Paths.route!"><code>route!</code></a>, creating flexible connections that are only resolved after floorplanning has determined the positions of the components to be connected.</p><div class="admonition is-info"><header class="admonition-header">Terminology note: connected component</header><div class="admonition-body"><p>There is a graph-theory term &quot;connected component&quot; unrelated to our <code>AbstractComponent</code>, indicating a subgraph whose nodes are all connected by edges and which isn&#39;t part of a larger such subgraph. For example, a fully connected graph has one connected component, the entire graph. Sometimes you may even hear these called &quot;components&quot;, but below we use &quot;connected component&quot; for the graph-theory sense and &quot;component&quot; for <code>AbstractComponent</code>.</p></div></div><p>In more detail: Typically, each <code>fuse!</code> operation fully determines the position and rotation of the new node. For each connected component, the first node added to the <code>SchematicGraph</code> is positioned at the origin. A typical workflow could start by creating a node with a &quot;chip template&quot; component containing port <a href="../components/#DeviceLayout.hooks"><code>hooks</code></a> and other boilerplate. We then <code>fuse!</code> any CPW launchers to the template. The devices in the middle of the chip are added and fused to one another without yet fixing their position relative to the chip template. Next, one connection is made between this connected component of devices and the connected component containing the template, fixing their relative positions. Since the chip template was added first, it will be centered at the origin.</p><p>At this point, further connections still need to be made between various device ports and CPW launchers positioned on the chip template, all of which are now fully constrained. Another constraint like those created by <code>fuse!</code> so far would overconstrain the layout, causing floorplanning with <code>plan</code> to fail. The remaining connections are instead made with <a href="../../routes/#DeviceLayout.Paths.route!"><code>route!</code></a>, which creates a <code>RouteNode</code> with edges to the <code>ComponentNode</code>s at its start and end points. Then, during <code>plan</code>, after the initial floorplanning phase has determined position of all fixed <code>Component</code>s, the route node finds a path between its start and end points.</p><div class="admonition is-success"><header class="admonition-header">Schematic connections without geometric constraints</header><div class="admonition-body"><p>You can add edges to the schematic graph that will be ignored during <code>plan</code> using the keyword <code>plan_skips_edge=true</code> in <code>fuse!</code>.</p></div></div><h2 id="Schematics-2"><a class="docs-heading-anchor" href="#Schematics-2">Schematics</a><a class="docs-heading-anchor-permalink" href="#Schematics-2" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.Schematic" href="#DeviceLayout.SchematicDrivenLayout.Schematic"><code>DeviceLayout.SchematicDrivenLayout.Schematic</code></a> ‚Äî <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct Schematic{S} &lt;: AbstractCoordinateSystem{S}</code></pre><p>Spatial representation of a layout in terms of <code>AbstractComponent</code>s rather than polygons.</p><p>Can be constructed from a <code>SchematicGraph</code> <code>g</code> using <code>plan(g)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L521-L527">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.plan" href="#DeviceLayout.SchematicDrivenLayout.plan"><code>DeviceLayout.SchematicDrivenLayout.plan</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">plan(g::SchematicGraph, hooks_fn=hooks; strict=:error, log_dir=&quot;build&quot;, log_level=Logging.Info)
plan(g::SchematicGraph, t::Target; strict=:error, log_dir=&quot;build&quot;, log_level=Logging.Info)</code></pre><p>Constructs a <code>Schematic</code> floorplan from <code>g</code> without rendering Components.</p><p>Iterates through the nodes in <code>g</code> depth-first to build a tree (or more than one, if the graph is disconnected) of <code>CoordinateSystem</code>s satisfying the translations, reflections, and rotations required by the hooks corresponding to each edge. Each <code>CoordinateSystem</code> holds a <code>StructureReference</code> to the <code>Component</code> in the corresponding node. A new <code>Schematic</code> is created containing references to the roots of these trees (sometimes called &quot;rendering trees&quot;) as well as a dictionary mapping each <code>ComponentNode</code> in <code>g</code> to the reference to that node&#39;s <code>CoordinateSystem</code> in its rendering tree. (This is the reference stored by its parent.)</p><p><code>plan</code> will ignore edges with the property <code>SchematicDrivenLayout.PLAN_SKIPS_EDGE=&gt;true</code>.</p><p>The <code>strict</code> keyword should be <code>:error</code>, <code>:warn</code>, or <code>:no</code>.</p><p>The <code>strict=:error</code> keyword option causes <code>plan</code> to throw an error if any errors were logged during planning. This is enabled by default, but can be disabled with <code>strict=:no</code>, in which case any node that was not successfully placed relative to an existing node will simply appear at the origin. Using <code>strict=:no</code> is recommended only for debugging purposes.</p><p>The <code>strict=:warn</code> keyword option causes <code>plan</code> to throw an error if any warnings were logged during planning. This is disabled by default. Using <code>strict=:warn</code> is suggested for use in automated pipelines, where warnings may require human review.</p><p>Log messages with level of at least <code>log_level</code> will be written to <code>joinpath(log_dir, name(g) * &quot;.log&quot;)</code>. If <code>logdir</code> is <code>nothing</code>, then no file will be written. The same log file will be used for <code>build!</code> and <code>render!</code> stages of the schematic workflow.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L864-L894">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.check!" href="#DeviceLayout.SchematicDrivenLayout.check!"><code>DeviceLayout.SchematicDrivenLayout.check!</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">check!(sch::Schematic; rules=[rotations_valid])</code></pre><p>Verifies that <code>sch</code> satisfies <code>rule(sch) == true</code> for each <code>rule</code> in <code>rules</code>, and sets <code>sch.checked = true</code> if it does.</p><p>By default, checks that all checkable components have an allowed global orientation (<a href="#DeviceLayout.SchematicDrivenLayout.rotations_valid"><code>rotations_valid(::Schematic)</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L1064-L1071">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.build!" href="#DeviceLayout.SchematicDrivenLayout.build!"><code>DeviceLayout.SchematicDrivenLayout.build!</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">build!(sch::Schematic, geometry_fn=geometry; strict=:error)
build!(sch::Schematic, t::Target; strict=:error)</code></pre><p>Replace the <code>AbstractComponent</code>s in <code>sch</code> with their <code>geometry</code>. Usually there&#39;s no reason to do this, since <code>render!</code> will still render the geometry but won&#39;t modify <code>sch</code>.</p><p>Users must run <code>check!(sch)</code> before calling this method; otherwise, it will throw an error.</p><p>The <code>strict</code> keyword should be <code>:error</code>, <code>:warn</code>, or <code>:no</code>.</p><p>The <code>strict=:error</code> keyword option causes <code>build!</code> to throw an error if any errors were logged while building component geometries. This is enabled by default, but can be disabled with <code>strict=:no</code>, in which case any component which was not successfully built will have an empty geometry. Using <code>strict=:no</code> is recommended only for debugging purposes.</p><p>The <code>strict=:warn</code> keyword option causes <code>build!</code> to throw an error if any warnings were logged. This is disabled by default. Using <code>strict=:warn</code> is suggested for use in automated pipelines, where warnings may require human review.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L1259-L1279">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.render!-Tuple{DeviceLayout.AbstractCoordinateSystem, DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.LayoutTarget}" href="#DeviceLayout.render!-Tuple{DeviceLayout.AbstractCoordinateSystem, DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.LayoutTarget}"><code>DeviceLayout.render!</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">render!(
    cs::AbstractCoordinateSystem,
    sch::Schematic,
    target::LayoutTarget;
    strict=:error,
    kwargs...
)</code></pre><p>Run <code>build!(sch, target)</code> and render the resulting geometry to <code>cs</code> using <code>target</code>&#39;s rendering options.</p><p>The <code>strict</code> keyword should be <code>:error</code>, <code>:warn</code>, or <code>:no</code>.</p><p>The <code>strict=:error</code> keyword option causes <code>render!</code> to throw an error if any errors were logged while building component geometries or while rendering geometries to <code>cs</code>. This is enabled by default, but can be disabled with <code>strict=:no</code>, in which case any component which was not successfully built will have an empty geometry, and any non-fatal rendering errors will be ignored as usual. Using <code>strict=:no</code> is recommended only for debugging purposes.</p><p>The <code>strict=:warn</code> keyword option causes <code>render!</code> to throw an error if any warnings were logged. This is disabled by default. Using <code>strict=:warn</code> is suggested for use in automated pipelines, where warnings may require human review.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L1339-L1362">source</a></section></article><h3 id="Inspecting-and-manipulating-schematics"><a class="docs-heading-anchor" href="#Inspecting-and-manipulating-schematics">Inspecting and manipulating schematics</a><a id="Inspecting-and-manipulating-schematics-1"></a><a class="docs-heading-anchor-permalink" href="#Inspecting-and-manipulating-schematics" title="Permalink"></a></h3><p>Schematics allow you to produce layouts by specifying designs at a high level, in terms of components and their connections. Often, this isn&#39;t quite enough to get the final artwork you want. Maybe a wire needs to be routed differently, or a component needs to be modified based on its position.</p><p>SchematicDrivenLayout allows you to inspect and modify a <code>Schematic</code> to make these sorts of changes before <code>build</code> renders it into polygons.</p><p>When you construct a <code>SchematicGraph</code>, you don&#39;t need to know exactly where a component will end up. You can usually calculate it yourself, but there are some built-in utilities to simplify things.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.indexof-Tuple{DeviceLayout.SchematicDrivenLayout.ComponentNode, DeviceLayout.SchematicDrivenLayout.SchematicGraph}" href="#DeviceLayout.SchematicDrivenLayout.indexof-Tuple{DeviceLayout.SchematicDrivenLayout.ComponentNode, DeviceLayout.SchematicDrivenLayout.SchematicGraph}"><code>DeviceLayout.SchematicDrivenLayout.indexof</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">indexof(n::ComponentNode, g::SchematicGraph)</code></pre><p>Finds the index of the node <code>n</code> in <code>g</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L81-L85">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.bounds-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}" href="#DeviceLayout.bounds-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}"><code>DeviceLayout.bounds</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">bounds(sch::Schematic, node::ComponentNode)
bounds(sch::Schematic, node_idx::Int)</code></pre><p>The <code>Rectangle</code> bounding the component in <code>node</code> in the global coordinate system of <code>sch</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L697-L702">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.center-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}" href="#DeviceLayout.center-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}"><code>DeviceLayout.center</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">center(sch::Schematic, node::ComponentNode)
center(sch::Schematic, node_idx::Int)</code></pre><p>The center of the <code>bounds</code> of <code>node</code>&#39;s component in the global coordinate system of <code>sch</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L684-L689">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.hooks-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}" href="#DeviceLayout.hooks-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}"><code>DeviceLayout.hooks</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">hooks(sch::Schematic, node::ComponentNode)</code></pre><p>The hooks belonging to the component in <code>node</code> in the global coordinate system of <code>sch</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L651-L655">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.Transformations.origin-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}" href="#DeviceLayout.Transformations.origin-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}"><code>DeviceLayout.Transformations.origin</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">origin(sch::Schematic, node::ComponentNode)
origin(sch::Schematic, node_idx::Int)</code></pre><p>The origin of <code>node</code> in the global coordinate system of <code>sch</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L672-L677">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.transformation-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}" href="#DeviceLayout.transformation-Tuple{DeviceLayout.SchematicDrivenLayout.Schematic, DeviceLayout.SchematicDrivenLayout.ComponentNode}"><code>DeviceLayout.transformation</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">transformation(sch::Schematic, node::ComponentNode)</code></pre><p>Given a Schematic <code>sch</code> containing <a href="#DeviceLayout.SchematicDrivenLayout.ComponentNode"><code>ComponentNode</code></a> <code>node</code> in its <code>SchematicGraph</code>, this function returns a <code>CoordinateTransformations.Transformation</code> object that lets you translate from the coordinate system of the node to the global coordinate system of <code>sch</code>.</p><p>Effectively a wrapper around <code>DeviceLayout.transformation(::CoordinateSystem, ::CoordSysRef)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L592-L601">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.find_components" href="#DeviceLayout.SchematicDrivenLayout.find_components"><code>DeviceLayout.SchematicDrivenLayout.find_components</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">find_components(f::Function, g::SchematicGraph; depth=-1)</code></pre><p>Return the indices of the nodes in <code>sch</code> or <code>g</code> for which <code>f(component(node))</code> is <code>true</code>.</p><p>Keyword <code>depth</code> is the number of layers of the graph to search within, where the subgraph of each <code>CompositeComponent</code> is a layer beyond the layer holding the <code>ComponentNode</code> for that <code>CompositeComponent</code>. To search only top-level components, use <code>depth=1</code>. To search all subgraphs recursively, use a negative depth (the default).</p><p>Indices for nodes in subgraphs are integers or <code>Tuple</code>s of integer indices, one for each additional layer. For example, if a node containing a <code>CompositeComponent</code> has index <code>2</code> in the top layer, then the third subcomponent in the <code>CompositeComponent</code>&#39;s graph has index <code>(2,3)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L710-L724">source</a></section><section><div><pre><code class="language-julia hljs">find_components(comptype::Type{T}, sch::Schematic; depth=-1) where {T &lt;: AbstractComponent}
find_components(comptype::Type{T}, g::SchematicGraph; depth=-1) where {T &lt;: AbstractComponent}</code></pre><p>Return the indices of nodes containing components of type <code>T</code>.</p><p>See <a href="#DeviceLayout.SchematicDrivenLayout.find_components"><code>find_components(::Function, ::SchematicGraph)</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L729-L736">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.find_nodes" href="#DeviceLayout.SchematicDrivenLayout.find_nodes"><code>DeviceLayout.SchematicDrivenLayout.find_nodes</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">find_nodes(f::Function, g::SchematicGraph; depth=-1)</code></pre><p>Return the indices of the nodes in <code>sch</code> or <code>g</code> for which <code>f(node)</code> is <code>true</code>.</p><p>Keyword <code>depth</code> is the number of layers of the graph to search within, where the subgraph of each <code>CompositeComponent</code> is a layer beyond the layer holding the <code>ComponentNode</code> for that <code>CompositeComponent</code>. To search only top-level components, use <code>depth=1</code>. To search all subgraphs recursively, use a negative depth (the default).</p><p>Indices for nodes in subgraphs are integers or <code>Tuple</code>s of integer indices, one for each additional layer. For example, if a node containing a <code>CompositeComponent</code> has index <code>2</code> in the top layer, then the third subcomponent in the <code>CompositeComponent</code>&#39;s graph has index <code>(2,3)</code>.</p><p>See also <a href="#DeviceLayout.SchematicDrivenLayout.find_components"><code>find_components</code></a>, which checks <code>f(component(node))</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L752-L768">source</a></section></article><p>If you have a <code>ComponentNode</code>, you can replace its component using an arbitrary function that takes the original component as an argument:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.replace_component!" href="#DeviceLayout.SchematicDrivenLayout.replace_component!"><code>DeviceLayout.SchematicDrivenLayout.replace_component!</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">replace_component!(sch::Schematic, node_index::Int, replacement::Function)</code></pre><p>Replaces the component <code>c</code> at <code>node_index</code> in <code>sch</code> with <code>replacement(c)</code>.</p><p><code>replacement</code> should return a new AbstractComponent with a unique name.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L781-L787">source</a></section></article><p>You can also replace it (or all components of that type) using a function that takes the position in schematic-global or wafer-global coordinates as an argument:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.position_dependent_replace!" href="#DeviceLayout.SchematicDrivenLayout.position_dependent_replace!"><code>DeviceLayout.SchematicDrivenLayout.position_dependent_replace!</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">position_dependent_replace!(sch::Schematic{S}, node_index::Int, replacement::Function;
    schematic_origin_globalcoords=zero(Point{S})) where {S}</code></pre><p>Replaces the component <code>c</code> at <code>node_index</code> in <code>sch</code> with <code>replacement</code>.</p><p>The replacement function should have a signature matching <code>replacement(c&lt;:AbstractComponent, c_origin_globalcoords::Point)</code> where <code>c</code> is the component to be replaced and <code>c_origin_globalcoords</code> is the component&#39;s origin in global coordinates. Here &quot;global&quot; coordinates are defined as those in which the schematic&#39;s origin is the keyword argument <code>schematic_origin_globalcoords</code> in <code>position_dependent_replace!</code>.</p><p><code>replacement</code> should return a new AbstractComponent with a unique name.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L809-L823">source</a></section><section><div><pre><code class="language-julia hljs">position_dependent_replace!(sch::Schematic{S}, comptype::Type{&lt;:AbstractComponent},
    replacement::Function;
    schematic_origin_globalcoords=zero(Point{S})) where {S}</code></pre><p>Replaces each component instance of type <code>comptype</code> in <code>sch</code> using <code>position_dependent_replace!</code> with the replacement function <code>replacement(c&lt;:AbstractComponent, c_origin_globalcoords::Point)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L841-L848">source</a></section></article><p>One other useful trick allows a kind of interactive routing. When you view your final layout built from the schematic, you may find that a route bends too sharply or goes too close to a component. You can write down the points it needs to go to in the schematic&#39;s global coordinate system, and add them as waypoints to the route. That is, if you go back to your layout script, before you <code>build!</code> the layout, you can do something like</p><pre><code class="language-julia hljs">### original script
g = SchematicGraph(&quot;example&quot;)
...
route_node = route!(g, args...)
...
floorplan = plan(g)
check!(floorplan)
### modifications
# waypoints are global coordinates, not relative to the route&#39;s origin
route_node.component.global_waypoints = true
route_node.component.r.waypoints = [Point(600.0Œºm, -3000.0Œºm)]
route_node.component.r.waydirs = [90¬∞]
### finalize
build!(floorplan)</code></pre><p>Now the route in <code>route_node</code> is guaranteed to pass through the point (600.0Œºm, -3000.0Œºm) on its way to its destination. If the <code>RouteRule</code>&#39;s implementation uses <code>waydirs</code>, then it will also have a direction of 90¬∞ at that point.</p><h3 id="Automatic-crossover-generation"><a class="docs-heading-anchor" href="#Automatic-crossover-generation">Automatic crossover generation</a><a id="Automatic-crossover-generation-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-crossover-generation" title="Permalink"></a></h3><p>You can automatically generate crossovers between <code>Path</code>s and <code>RouteComponent</code>s, including those nested within composite components. This is based on <a href="../../paths/#Intersections"><code>Path</code> intersection functionality</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.crossovers!" href="#DeviceLayout.SchematicDrivenLayout.crossovers!"><code>DeviceLayout.SchematicDrivenLayout.crossovers!</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">crossovers!(sch::Schematic, xsty::DeviceLayout.Paths.Intersect.IntersectStyle)</code></pre><p>Splice crossovers into intersecting <code>Path</code>s and <code>RouteComponent</code>s.</p><p><code>RouteComponents</code> will cross over <code>Path</code>s, and otherwise components added to the schematic graph later will cross over those added earlier.</p><p><strong>Example</strong></p><pre><code class="nohighlight hljs">    g = SchematicGraph(&quot;crossover_example&quot;)
    # ...
    floorplan = plan(g)
    xsty = Intersect.AirBridge(
        crossing_gap=5Œºm,
        foot_gap=2Œºm,
        foot_length=4Œºm,
        extent_gap=2Œºm,
        scaffold_gap=5Œºm,
        scaffold_meta=GDSMeta(5),
        air_bridge_meta=GDSMeta(3)
        )
    SchematicDrivenLayout.crossovers!(floorplan, xsty)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L1141-L1166">source</a></section><section><div><pre><code class="language-julia hljs">crossovers!(sch::Schematic, xsty::DeviceLayout.Paths.Intersect.IntersectStyle,
    nodes_1, nodes_2)</code></pre><p>Splice crossovers into intersecting <code>Path</code>s and <code>RouteComponent</code>s.</p><p>Components in <code>nodes_2</code> will cross over any components in <code>nodes_1</code>, and otherwise components added to the schematic graph later will cross over those added earlier.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L1173-L1181">source</a></section></article><h3 id="Checking-schematics"><a class="docs-heading-anchor" href="#Checking-schematics">Checking schematics</a><a id="Checking-schematics-1"></a><a class="docs-heading-anchor-permalink" href="#Checking-schematics" title="Permalink"></a></h3><p>It is often necessary to check that a planned <code>Schematic</code> obeys a set of constraints set by the fabrication process. For instance, one may want to verify that all the junctions in a floorplan are oriented in the right direction, e.g. pointing north. Instead of doing this by eye, users should call <code>check!(sch::Schematic)</code>. In the future, this method could run any number of checks, but at present it only checks the global orientation of <a href="../components/#DeviceLayout.SchematicDrivenLayout.check_rotation"><em>checkable</em></a> components via the following methods:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.SchematicDrivenLayout.rotations_valid" href="#DeviceLayout.SchematicDrivenLayout.rotations_valid"><code>DeviceLayout.SchematicDrivenLayout.rotations_valid</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rotations_valid(sch::Schematic)</code></pre><p>Verifies that all checkable components in <code>sch</code> have the right orientation in the global coordinate system (returns <code>true</code> if successful and throws an error otherwise). A component of type <code>T</code> is checkable if <code>check_rotation(::T) = true</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L1080-L1086">source</a></section></article><p>To be able to <code>build!</code> a floorplan (i.e. turn components into their <code>CoordinateSystem</code> geometries), users <em>must</em> run <code>check!</code> first, otherwise <code>build</code> will throw an error.</p><h2 id="Visualization"><a class="docs-heading-anchor" href="#Visualization">Visualization</a><a id="Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization" title="Permalink"></a></h2><p>SchematicDrivenLayout also contains some prototype schematic-visualization methods: if <code>GraphMakie</code> is present in the environment, then <code>GraphMakie.graphplot</code> can be used with a <code>SchematicGraph</code> to show nodes and edges or with <code>Schematic</code> to also place the components at their on-chip positions.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../hooks/">¬´ Hooks</a><a class="docs-footer-nextpage" href="../technologies/">Technologies ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Thursday 27 February 2025 13:39">Thursday 27 February 2025</span>. Using Julia version 1.10.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
