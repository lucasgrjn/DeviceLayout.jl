<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Overview · DeviceLayout.jl</title><meta name="title" content="Overview · DeviceLayout.jl"/><meta property="og:title" content="Overview · DeviceLayout.jl"/><meta property="twitter:title" content="Overview · DeviceLayout.jl"/><meta name="description" content="Documentation for DeviceLayout.jl."/><meta property="og:description" content="Documentation for DeviceLayout.jl."/><meta property="twitter:description" content="Documentation for DeviceLayout.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DeviceLayout.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Geometry-Level Layout</span><ul><li class="is-active"><a class="tocitem" href>Overview</a><ul class="internal"><li><a class="tocitem" href="#Entities:-Transformations,-Clipping,-Styles"><span>Entities: Transformations, Clipping, Styles</span></a></li><li><a class="tocitem" href="#Cells-and-Rendering"><span>Cells and Rendering</span></a></li><li><a class="tocitem" href="#Paths-and-References"><span>Paths and References</span></a></li><li><a class="tocitem" href="#Coordinate-Systems"><span>Coordinate Systems</span></a></li><li><a class="tocitem" href="#Solid-Models"><span>Solid Models</span></a></li><li><a class="tocitem" href="#Data-flow-diagrams"><span>Data flow diagrams</span></a></li></ul></li><li><a class="tocitem" href="../units/">Units</a></li><li><a class="tocitem" href="../points/">Points</a></li><li><a class="tocitem" href="../geometry/">Geometry</a></li><li><a class="tocitem" href="../transformations/">Transformations</a></li><li><a class="tocitem" href="../entitystyles/">Entity Styles</a></li><li><a class="tocitem" href="../polygons/">Polygons</a></li><li><a class="tocitem" href="../coordinate_systems/">Coordinate Systems</a></li><li><a class="tocitem" href="../texts/">Texts</a></li><li><a class="tocitem" href="../paths/">Paths</a></li><li><a class="tocitem" href="../routes/">Routes</a></li><li><a class="tocitem" href="../shapes/">Shape library</a></li><li><a class="tocitem" href="../autofill/">Autofill</a></li><li><a class="tocitem" href="../render/">Rendering</a></li><li><a class="tocitem" href="../solidmodels/">Solid Models (3D Geometry)</a></li><li><a class="tocitem" href="../fileio/">File Formats</a></li><li><a class="tocitem" href="../faq/">Troubleshooting/FAQ</a></li></ul></li><li><span class="tocitem">Schematic-Driven Layout</span><ul><li><a class="tocitem" href="../schematicdriven/">Overview</a></li><li><a class="tocitem" href="../schematicdriven/components/">Components</a></li><li><a class="tocitem" href="../schematicdriven/hooks/">Hooks</a></li><li><a class="tocitem" href="../schematicdriven/schematics/">Schematics</a></li><li><a class="tocitem" href="../schematicdriven/technologies/">Technologies</a></li><li><a class="tocitem" href="../schematicdriven/targets/">Targets</a></li><li><a class="tocitem" href="../schematicdriven/solidmodels/">Solid Models</a></li><li><a class="tocitem" href="../schematicdriven/pdks/">PDKs</a></li><li><a class="tocitem" href="../schematicdriven/faq/">Troubleshooting/FAQ</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/examplepdk/">ExamplePDK</a></li><li><a class="tocitem" href="../examples/qpu17/">Quantum Processor</a></li><li><a class="tocitem" href="../examples/singletransmon/">Single-Transmon Simulation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Geometry-Level Layout</a></li><li class="is-active"><a href>Overview</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Overview</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/aws-cqc/DeviceLayout.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/main/docs/src/geometrylevel.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Geometry-Level-Layout:-Overview"><a class="docs-heading-anchor" href="#Geometry-Level-Layout:-Overview">Geometry-Level Layout: Overview</a><a id="Geometry-Level-Layout:-Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Geometry-Level-Layout:-Overview" title="Permalink"></a></h1><p>DeviceLayout.jl lets you define shapes, place shapes in structures, and place references to structures inside other structures. We call this workflow &quot;geometry-level layout&quot;, the most basic way of interacting with DeviceLayout.jl.</p><p>Within the DeviceLayout.jl type hierarchy, <a href="../geometry/#Entities">&quot;shapes&quot; are <code>GeometryEntity</code> subtypes</a> like <code>Polygon</code> and <code>Rectangle</code>.</p><p><a href="../geometry/#Structures">&quot;Structures&quot; are <code>GeometryStructure</code> subtypes</a> like <code>Cell</code>, <code>CoordinateSystem</code>, <code>Path</code>, and <code>Component</code>. A structure can contain many entities (its &quot;elements&quot;), and it associates each entity with its own piece of metadata (generally specifying the &quot;layer&quot; that entity belongs to).</p><p>Structures may also contain <a href="../geometry/#References">references to other structures</a>: the main type, <code>StructureReference</code>, wraps a structure together with a coordinate transformation that specifies its relative positioning and orientation within the containing structure.</p><p>To be more concrete, let&#39;s take a look at some examples that showcase different geometry-level workflows.</p><h2 id="Entities:-Transformations,-Clipping,-Styles"><a class="docs-heading-anchor" href="#Entities:-Transformations,-Clipping,-Styles">Entities: Transformations, Clipping, Styles</a><a id="Entities:-Transformations,-Clipping,-Styles-1"></a><a class="docs-heading-anchor-permalink" href="#Entities:-Transformations,-Clipping,-Styles" title="Permalink"></a></h2><p>Starting with a rectangle, let&#39;s demonstrate <a href="../transformations/">transformations</a>, <a href="../polygons/#Clipping">polygon clipping</a>, and a <a href="../entitystyles/">style</a>.</p><pre><code class="language-julia hljs">using DeviceLayout, FileIO
import DeviceLayout: μm, nm

r = centered(Rectangle(20μm, 40μm))
# Create a second rectangle rotated by 90 degrees, positioned below the first
r2 = Align.below(Rotation(90°)(r), r, centered=true) # centered in x-coordinate
r3 = Align.above(r2, r) # Another copy of r2 above the first rectangle
dogbone = union2d([r, r2, r3]) # Boolean union of the three rectangles as a single entity
rounded_dogbone = Rounded(4μm)(dogbone) # Apply the Rounded style</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DeviceLayout.StyledEntity{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, ClippedPolygon{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}, Rounded{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(ClippedPolygon{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}(Top-level PolyNode with 1 immediate children.), Rounded{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}(4.0 μm, 0.0, 4.0 μm, 0.001, Point{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}[], false))</code></pre><p>It&#39;s a bit hard to read, but the result is a <code>StyledEntity{T,U,S}</code> with three type parameters: the coordinate type <code>T = typeof(1.0μm}</code>, the underlying entity type <code>U = ClippedPolygon{T}</code>, and the style <code>S = Rounded{T}</code>—that is, it is a <code>GeometryEntity</code> that composes the result of a polygon clipping (Boolean) operation with a <code>GeometryEntityStyle</code> specifying rules for rounding that entity.</p><p>What&#39;s notable here is that <code>rounded_dogbone</code> only describes the vertices of the dogbone polygon and the rounding radius—in particular, it has not done any calculations to find a discretization of the rounded corners.</p><h2 id="Cells-and-Rendering"><a class="docs-heading-anchor" href="#Cells-and-Rendering">Cells and Rendering</a><a id="Cells-and-Rendering-1"></a><a class="docs-heading-anchor-permalink" href="#Cells-and-Rendering" title="Permalink"></a></h2><p>The simplest workflow for generating 2D layouts is to render entities directly to a <code>Cell</code>. (That&#39;s why we used it for <a href="../#Quick-start">the &quot;quick start&quot; example</a>.)</p><p>The <a href="../coordinate_systems/#DeviceLayout.Cells.Cell"><code>Cell</code></a> abstraction is meant to correspond to the GDSII backend, which uses <code>Polygon</code> as its only primitive entity type. In other words, rendering a complicated entity like our <code>rounded_dogbone</code> to a <code>Cell</code> will convert it to a <code>Polygon</code> representation of the same shape—just a list of points.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>By default, <code>render!(::Cell, ...)</code> discretizes a <code>Rounded</code> curve with absolute tolerance of <code>1nm</code>—that&#39;s the furthest any point on the true curve is from any line segment on the discretized version. This can be controlled in different ways, like providing the <code>atol</code> keyword to <code>render!</code>, or by composing the <code>ToTolerance</code> style on top of the <code>Rounded</code> style. Internally, an <code>atol</code> keyword then gets passed to the method <code>to_polygons(::AbstractPolygon{S}, ::Rounded{T}; kwargs...)</code>.</p></div></div><pre><code class="language-julia hljs">cr = Cell(&quot;dogbone&quot;, nm)
render!(cr, rounded_dogbone, GDSMeta(1))
elements(cr)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{Polygon{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}:
 Polygon{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}(Point{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}[(-16000.0 nm,-20000.0 nm), (-16178.825816 nm,-20003.999333 nm), (-16357.294038999999 nm,-20015.989336 nm), (-16535.047794000002 nm,-20035.946032 nm), (-16711.731631 nm,-20063.829514999998 nm), (-16886.992243 nm,-20099.584026999997 nm), (-17060.479165 nm,-20143.138070999998 nm), (-17231.845483 nm,-20194.404552999997 nm), (-17400.74852 nm,-20253.280958000003 nm), (-17566.850527 nm,-20319.649551000002 nm)  …  (-12433.149473 nm,-19680.350448999998 nm), (-12599.251479999999 nm,-19746.719041999997 nm), (-12768.154516999999 nm,-19805.595447000003 nm), (-12939.520835 nm,-19856.861929000002 nm), (-13113.007757 nm,-19900.415973000003 nm), (-13288.268369000001 nm,-19936.170485000002 nm), (-13464.952206 nm,-19964.053968 nm), (-13642.705961000001 nm,-19984.010664 nm), (-13821.174184 nm,-19996.000667 nm), (-14000.0 nm,-20000.0 nm)])</code></pre><p>Our <code>Rounded</code> <code>ClippedPolygon</code> has been reduced to a mere <code>Polygon</code>, as necessary to represent it within the GDSII format. It&#39;s also what we need in order to use the SVG backend:</p><pre><code class="language-julia hljs">save(&quot;dogbone.svg&quot;, cr; layercolors=Dict(0 =&gt; (0, 0, 0, 1), 1 =&gt; (1, 0, 0, 1)));</code></pre><img src="../dogbone.svg" style="width: 1in;"/><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>Our <code>ClippedPolygon</code> isn&#39;t doing anything special, here—it might as well be a <code>Polygon</code> in this example. <a href="../polygons/#DeviceLayout.Polygons.ClippedPolygon">The <code>ClippedPolygon</code> type</a> mainly exists to represent polygons with holes without having to generate &quot;keyhole&quot; polygons as required by the GDSII format. This ends up being convenient for other backends that don&#39;t want keyhole polygons as well as for applying different styles to different boundary or hole contours.</p></div></div><h2 id="Paths-and-References"><a class="docs-heading-anchor" href="#Paths-and-References">Paths and References</a><a id="Paths-and-References-1"></a><a class="docs-heading-anchor-permalink" href="#Paths-and-References" title="Permalink"></a></h2><p>We can now create references to our cell, place those references in a structure, and render the whole structure to another cell. Let&#39;s do that with a <a href="../paths/#DeviceLayout.Paths.Path"><code>Path</code></a> structure, as in our quick-start example:</p><pre><code class="language-julia hljs">cref = sref(cr, Point(0.0μm, 0.0μm)) # sref is short for &quot;structure [or single] reference&quot;
p = Path(μm, metadata=GDSMeta())
sty = launch!(p)
straight!(p, 500μm, sty)
turn!(p, π / 2, 150μm)
straight!(p, 500μm)
launch!(p)
turnidx = Int((length(p) + 1) / 2) - 1 # the first straight segment of the path
simplify!(p, turnidx .+ (0:2))
attach!(p, cref, (60μm):(60μm):((pathlength(p[turnidx])) - 60μm), i=turnidx)
c = Cell(&quot;decoratedpath&quot;, nm)
render!(c, p)
refs(c)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">19-element Vector{DeviceLayout.GeometryReference{S, T} where {S, T&lt;:DeviceLayout.Cells.AbstractCell}}:
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.3e6 nm,554380.5509807655 nm), false, 1.0, 1.5707963267948966)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.3e6 nm,494380.55098076555 nm), false, 1.0, 1.5707963267948966)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.3e6 nm,434380.55098076555 nm), false, 1.0, 1.5707963267948966)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.3e6 nm,374380.55098076555 nm), false, 1.0, 1.5707963267948966)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.3e6 nm,314380.55098076555 nm), false, 1.0, 1.5707963267948966)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.3e6 nm,254380.55098076552 nm), false, 1.0, 1.5707963267948966)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.3e6 nm,194380.55098076552 nm), false, 1.0, 1.5707963267948966)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.2991875105902583e6 nm,134408.76259299737 nm), false, 1.0, 1.4666666666666668)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.2813392829715037e6 nm,77543.1663089585 nm), false, 1.0, 1.0666666666666669)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.2427554704604605e6 nm,32116.910883457793 nm), false, 1.0, 0.6666666666666667)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.1895276086715304e6 nm,5301.803215415419 nm), false, 1.0, 0.2666666666666667)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.13e6 nm,0.0 nm), false, 1.0, 0.0)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.07e6 nm,0.0 nm), false, 1.0, 0.0)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (1.01e6 nm,0.0 nm), false, 1.0, 0.0)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (950000.0 nm,0.0 nm), false, 1.0, 0.0)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (890000.0 nm,0.0 nm), false, 1.0, 0.0)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (830000.0 nm,0.0 nm), false, 1.0, 0.0)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (770000.0 nm,0.0 nm), false, 1.0, 0.0)
 CellReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Cell{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Cell &quot;dogbone&quot; with 1 els, 0 refs, (710000.0 nm,0.0 nm), false, 1.0, 0.0)</code></pre><p>The entities making up the <code>Path</code> are rendered into <code>Polygon</code>s, but the <code>GeometryReference</code>s stored in the <code>Path</code> are simply placed into our <code>Cell</code> as references, since they&#39;re already <code>Cell</code> references. Note that we have many references to the same <code>Cell</code> called <code>&quot;dogbone&quot;</code> here—it hasn&#39;t been copied.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>If you&#39;re paying close attention, you might have noticed that <code>Path</code> handles entity metadata slightly differently than a <code>GeometryStructure</code> like <code>Cell</code>. The <code>Path</code>&#39;s elements—the launchers and CPW-styled segments—are all associated with a single piece of metadata, rather than allowing the possibility of different metadata for each. As a structure, though, the <code>Path</code> can still have references to other structures with all sorts of different metadata associated with their elements.</p></div></div><p>Let&#39;s see how it looks:</p><pre><code class="language-julia hljs">save(&quot;dogbone_path.svg&quot;, flatten(c); layercolors=Dict(0 =&gt; (0, 0, 0, 1), 1 =&gt; (1, 0, 0, 1)));</code></pre><img src="../dogbone_path.svg" style="width: 3in;"/><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>The SVG backend only draws the top-level <code>Cell</code>, so it&#39;s necessary to <a href="../geometry/#Flattening"><code>flatten</code></a> the cell before saving. <code>flatten</code> traverses references to place all entities in a single <code>Cell</code>, applying transformations as necessary.</p></div></div><p>(For further examples, we&#39;ll hide the line that saves to SVG just to display a cell.)</p><p>Of course, we can also add <code>Cell</code> references directly to a <code>Cell</code>, for example to apply a global rotation:</p><pre><code class="language-julia hljs">c_wrapper = Cell(&quot;wrapper&quot;, nm)
addref!(c_wrapper, sref(c, rot=90°))</code></pre><img src="../rotated_dogbone_path.svg" style="width: 3in;"/><h2 id="Coordinate-Systems"><a class="docs-heading-anchor" href="#Coordinate-Systems">Coordinate Systems</a><a id="Coordinate-Systems-1"></a><a class="docs-heading-anchor-permalink" href="#Coordinate-Systems" title="Permalink"></a></h2><p>We&#39;ve been working with <code>Cell</code>s in the above examples because they&#39;re convenient for displaying immediately, but in practice, you&#39;ll usually want to work with <a href="../coordinate_systems/#DeviceLayout.CoordinateSystems.CoordinateSystem"><code>CoordinateSystem</code></a>. The two are very similar—both are subtypes of <code>AbstractCoordinateSystem</code>—but where <code>Cell</code> is tied to the GDSII backend, <code>CoordinateSystem</code> is the &quot;DeviceLayout.jl-native&quot; geometry structure.</p><p>In particular, any <code>GeometryEntity</code> can be placed in a <code>CoordinateSystem</code>, like our <code>rounded_dogbone</code> from before. (If <code>Polygon</code> is the only <code>Cell</code> primitive, then every <code>GeometryEntity</code> is a <code>CoordinateSystem</code> primitive.) That way, backend-specific decisions about how to render it can be deferred. This will become clear when we get to the <code>SolidModel</code> backend below.</p><pre><code class="language-julia hljs">csr = CoordinateSystem(&quot;dogbone&quot;, nm)
place!(csr, rounded_dogbone, SemanticMeta(:bridge))
elements(csr)[1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DeviceLayout.StyledEntity{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, ClippedPolygon{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}, Rounded{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(ClippedPolygon{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}(Top-level PolyNode with 1 immediate children.), Rounded{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}(4.0 μm, 0.0, 4.0 μm, 0.001, Point{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(μm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}[], false))</code></pre><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p><code>place!</code> can only be used with <code>CoordinateSystem</code>s. It does the same thing as <code>render!</code>, which still works, but the verb is less ambiguous. If you know you&#39;re only working with <code>CoordinateSystem</code>s, it may be clearer to use <code>place!</code>, since <code>render!</code> suggests rendering to primitives—which can mean different things depending on the &quot;backend&quot;.</p></div></div><p>We&#39;re also free to use any type of metadata to describe layers, not just <code>GDSMeta</code>. In this case, we use <a href="../coordinate_systems/#DeviceLayout.SemanticMeta"><code>SemanticMeta</code></a> with the layer symbol <code>:bridge</code>.</p><p>You can do just about anything with a <code>CoordinateSystem</code> that you could do with a <code>Cell</code>, and some things you couldn&#39;t. For example, rendering a <code>Path</code> to a <code>Cell</code> converted it into <code>Polygon</code>s—a <code>Cell</code> can only hold references to other <code>Cell</code>s, not arbitrary structures. <code>CoordinateSystem</code> doesn&#39;t have that limitation:</p><pre><code class="language-julia hljs">csref = sref(csr, Point(0.0μm, 0.0μm))
p = Path(nm, metadata=SemanticMeta(:metal_negative))
sty = launch!(p, trace1=4μm, gap1=4μm)
straight!(p, 500μm, sty)
turn!(p, π / 2, 150μm)
straight!(p, 500μm)
launch!(p, trace1=4μm, gap1=4μm)
turnidx = Int((length(p) + 1) / 2) - 1 # the first straight segment of the path
simplify!(p, turnidx .+ (0:2))
attach!(p, csref, (60μm):(60μm):((pathlength(p[turnidx])) - 60μm), i=turnidx)
cs = CoordinateSystem(&quot;decoratedpath&quot;, nm)
addref!(cs, p) # either render! or place! would do the same thing here
refs(cs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{DeviceLayout.GeometryReference}:
 StructureReference{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}, Path{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}}(Path{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}(&quot;path\$3239&quot;, (0.0 nm,0.0 nm), 0.0°, SemanticMeta(:metal_negative, 1, 1), DeviceLayout.Paths.Node{Unitful.Quantity{Float64, 𝐋, Unitful.ContextUnits{(nm,), 𝐋, Unitful.FreeUnits{(nm,), 𝐋, nothing}, nothing}}}[Straight by 155000.0 nm styled as Open termination of CPW with width 300000.0 nm, gap 150000.0 nm, and rounding radius 5000.0 nm, Straight by 245000.0 nm styled as CPW with width 300000.0 nm and gap 150000.0 nm, Straight by 250000.0 nm styled as Tapered CPW with initial width 300000.0 nm and initial gap 150000.0 nm tapers to a final width 4000.0 nm and final gap 4000.0 nm, 3 segments styled as Compound style with 19 decorations, Straight by 250000.0 nm styled as Tapered CPW with initial width 4000.0 nm and initial gap 4000.0 nm tapers to a final width 300000.0 nm and final gap 150000.0 nm, Straight by 245000.0 nm styled as CPW with width 300000.0 nm and gap 150000.0 nm, Straight by 155000.0 nm styled as Open termination of CPW with width 300000.0 nm, gap 150000.0 nm, and rounding radius 5000.0 nm], CoordinateSystem &quot;cs_path$3239&quot; with 0 els, 0 refs), (0.0 nm,0.0 nm), false, 1.0, 0.0)</code></pre><p>Of course, eventually we&#39;ll want to turn this into a <code>Cell</code>. Since we were using named <code>SemanticMeta</code> layers, we just need to specify how to convert them to <code>GDSMeta</code>:</p><pre><code class="language-julia hljs">layer_record = Dict(:bridge =&gt; GDSMeta(1), :metal_negative =&gt; GDSMeta())
cell = Cell(cs; map_meta=m -&gt; layer_record[layer(m)])
# Could also say cell = render!(Cell(&quot;newcell&quot;, nm), cs; map_meta=...)
save(
    &quot;cs_dogbone_path.svg&quot;,
    flatten(cell);
    layercolors=Dict(0 =&gt; (0, 0, 0, 1), 1 =&gt; (1, 0, 0, 1))</code></pre><img src="../cs_dogbone_path.svg" style="width: 3in;"/><h2 id="Solid-Models"><a class="docs-heading-anchor" href="#Solid-Models">Solid Models</a><a id="Solid-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Solid-Models" title="Permalink"></a></h2><p>We can also render the same <code>CoordinateSystem</code> to a <a href="../solidmodels/">3D model</a>. DeviceLayout.jl uses <a href="https://dev.opencascade.org/">Open CASCADE Technology</a>, an open-source 3D geometry library, through the API provided by <a href="https://www.gmsh.info/doc/texinfo/gmsh.html">Gmsh</a>, a 3D finite element mesh generator.</p><p>Even though our geometry is purely 2D, we can generate a <code>SolidModel</code> by providing a map from layer name to position in the third dimension (<code>zmap</code>) as well as a list of Booleans, extrusions, and other operations to perform after rendering the 2D entities (<code>postrender_ops</code>).</p><p>It&#39;s not really recommended to do this directly from geometry-level layout. There are tools in the schematic-driven layout interface that handle some of the complexity for you. We&#39;ll have an analogous overview later that showcases all of that, but for the sake of demonstration, here&#39;s a simple (relatively) manual example. (Making bridges in particular can be a bit involved, so there&#39;s a helper method to generate the postrendering operations for a basic &quot;staple&quot; configuration.)</p><p>We&#39;ll add a few more rectangles to help with 3D operations—one that will intersect with our &quot;bridge&quot; pattern to create a 3D &quot;staple&quot;, one to extrude the substrate volume, and one to define a larger volume above and below the substrate.</p><pre><code class="language-julia hljs">place!(csr, centered(Rectangle(30μm, 15μm)), :base)
place!.(cs, offset(bounds(cs), 200μm), :substrate)
place!(cs, bounds(cs), :simulated_area)
zmap = (m) -&gt; layer(m) == :simulated_area ? -1000μm : 0μm
postrender_ops = [
    (&quot;substrate_extrusion&quot;, SolidModels.extrude_z!, (&quot;substrate&quot;, -500μm))
    (&quot;simulated_area_extrusion&quot;, SolidModels.extrude_z!, (&quot;simulated_area&quot;, 2000μm))
    (&quot;metal&quot;, SolidModels.difference_geom!, (&quot;substrate&quot;, &quot;metal_negative&quot;))
    SolidModels.staple_bridge_postrendering(; base=&quot;base&quot;, bridge=&quot;bridge&quot;)
]
sm = SolidModel(&quot;model&quot;, overwrite=true)
SolidModels.gmsh.option.setNumber(&quot;General.Verbosity&quot;, 0)
render!(sm, cs; zmap=zmap, postrender_ops=postrender_ops);</code></pre><p>We can look at the current model in the Gmsh GUI:</p><pre><code class="language-julia hljs">SolidModels.gmsh.fltk.run()</code></pre><img src="../assets/gmsh_example.png"/><p>Let&#39;s zoom in on the CPW bend:</p><img src="../assets/gmsh_zoom.png"/><p>One notable thing about this solid model is that the arcs in the bent CPW are exact circular arcs. When we render to a <code>Cell</code>, all shapes get discretized into <code>Polygon</code>s. But since we were working with our &quot;native&quot; <code>CoordinateSystem</code>, curved shapes like the CPW bend can be rendered as native curves in the solid geometry kernel. This not only keeps model size down but also allows Gmsh to make better meshes.</p><p>Moreover, when DeviceLayout.jl renders path segments and certain other entities, it automatically sets mesh sizing information to help Gmsh make better meshes. (You can also annotate entities with the <a href="../entitystyles/#DeviceLayout.MeshSized">MeshSized</a> style to provide such information manually.)</p><pre><code class="language-julia hljs">SolidModels.gmsh.model.mesh.generate(3)</code></pre><img src="../assets/mesh_example.png"/>

<img src="../assets/mesh_zoom.png"/><p>Compare this to what happens if we render to polygons first.</p><pre><code class="language-julia hljs">layer_record = Dict(
    :substrate =&gt; GDSMeta(0),
    :simulated_area =&gt; GDSMeta(1),
    :metal_negative =&gt; GDSMeta(2),
    :base =&gt; GDSMeta(3),
    :bridge =&gt; GDSMeta(4)
)
cell = Cell(cs; map_meta=m -&gt; layer_record[layer(m)])
### Fix for duplicate consecutive points on certain rounded polygons
### GDS doesn&#39;t care but Gmsh/OCCT do care
flatten!(cell)
cell.elements .= Polygon.([unique(points(poly)) for poly in elements(cell)])
###
lyr(name) = layername(layer_record[Symbol(name)])
gds_postrender_ops = [
    (&quot;substrate_extrusion&quot;, SolidModels.extrude_z!, (lyr(&quot;substrate&quot;), -500μm))
    (&quot;simulated_area_extrusion&quot;, SolidModels.extrude_z!, (lyr(&quot;simulated_area&quot;), 2000μm))
    (&quot;metal&quot;, SolidModels.difference_geom!, (lyr(&quot;substrate&quot;), lyr(&quot;metal_negative&quot;)))
    SolidModels.staple_bridge_postrendering(; base=lyr(&quot;base&quot;), bridge=lyr(&quot;bridge&quot;))
]
sm = SolidModel(&quot;model&quot;, overwrite=true)
render!(sm, cell; zmap=zmap, postrender_ops=gds_postrender_ops)
SolidModels.gmsh.model.mesh.generate(2) # 3D meshing may hit an error—have to be careful about postrendering</code></pre><p>Not only is this <code>render!</code> call much slower, but the mesh is forced to use every point on the 1nm-tolerance-discretization of the curve. Without any help from the rich information in the original geometry, Gmsh also uses its default settings—resulting in a very poor mesh.</p><img src="../assets/mesh_bad.png"/><h2 id="Data-flow-diagrams"><a class="docs-heading-anchor" href="#Data-flow-diagrams">Data flow diagrams</a><a id="Data-flow-diagrams-1"></a><a class="docs-heading-anchor-permalink" href="#Data-flow-diagrams" title="Permalink"></a></h2><p>It may be easier to understand the flow of data with a diagram. Here&#39;s one for the &quot;quick start&quot; workflow, working directly with <code>Cell</code>s:</p><img src="../assets/cell_dataflow.jpg"/><p>And here&#39;s a diagram for the typical <code>CoordinateSystem</code> workflow:</p><img src="../assets/coordinatesystem_dataflow.jpg"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../units/">Units »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Thursday 27 February 2025 13:39">Thursday 27 February 2025</span>. Using Julia version 1.10.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
