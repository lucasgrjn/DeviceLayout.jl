<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rendering · DeviceLayout.jl</title><meta name="title" content="Rendering · DeviceLayout.jl"/><meta property="og:title" content="Rendering · DeviceLayout.jl"/><meta property="twitter:title" content="Rendering · DeviceLayout.jl"/><meta name="description" content="Documentation for DeviceLayout.jl."/><meta property="og:description" content="Documentation for DeviceLayout.jl."/><meta property="twitter:description" content="Documentation for DeviceLayout.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DeviceLayout.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Geometry-Level Layout</span><ul><li><a class="tocitem" href="../geometrylevel/">Overview</a></li><li><a class="tocitem" href="../units/">Units</a></li><li><a class="tocitem" href="../points/">Points</a></li><li><a class="tocitem" href="../geometry/">Geometry</a></li><li><a class="tocitem" href="../transformations/">Transformations</a></li><li><a class="tocitem" href="../entitystyles/">Entity Styles</a></li><li><a class="tocitem" href="../polygons/">Polygons</a></li><li><a class="tocitem" href="../coordinate_systems/">Coordinate Systems</a></li><li><a class="tocitem" href="../texts/">Texts</a></li><li><a class="tocitem" href="../paths/">Paths</a></li><li><a class="tocitem" href="../routes/">Routes</a></li><li><a class="tocitem" href="../shapes/">Shape library</a></li><li><a class="tocitem" href="../autofill/">Autofill</a></li><li class="is-active"><a class="tocitem" href>Rendering</a><ul class="internal"><li><a class="tocitem" href="#Render-methods"><span>Render methods</span></a></li><li><a class="tocitem" href="#Rendering-arbitrary-paths"><span>Rendering arbitrary paths</span></a></li></ul></li><li><a class="tocitem" href="../solidmodels/">Solid Models (3D Geometry)</a></li><li><a class="tocitem" href="../fileio/">File Formats</a></li><li><a class="tocitem" href="../faq/">Troubleshooting/FAQ</a></li></ul></li><li><span class="tocitem">Schematic-Driven Layout</span><ul><li><a class="tocitem" href="../schematicdriven/">Overview</a></li><li><a class="tocitem" href="../schematicdriven/components/">Components</a></li><li><a class="tocitem" href="../schematicdriven/hooks/">Hooks</a></li><li><a class="tocitem" href="../schematicdriven/schematics/">Schematics</a></li><li><a class="tocitem" href="../schematicdriven/technologies/">Technologies</a></li><li><a class="tocitem" href="../schematicdriven/targets/">Targets</a></li><li><a class="tocitem" href="../schematicdriven/solidmodels/">Solid Models</a></li><li><a class="tocitem" href="../schematicdriven/pdks/">PDKs</a></li><li><a class="tocitem" href="../schematicdriven/faq/">Troubleshooting/FAQ</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/examplepdk/">ExamplePDK</a></li><li><a class="tocitem" href="../examples/qpu17/">Quantum Processor</a></li><li><a class="tocitem" href="../examples/singletransmon/">Single-Transmon Simulation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Geometry-Level Layout</a></li><li class="is-active"><a href>Rendering</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Rendering</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/aws-cqc/DeviceLayout.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/main/docs/src/render.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Render-methods"><a class="docs-heading-anchor" href="#Render-methods">Render methods</a><a id="Render-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Render-methods" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.render!" href="#DeviceLayout.render!"><code>DeviceLayout.render!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">render!(c::Cell, p::Polygon, meta::GDSMeta=GDSMeta())</code></pre><p>Render a polygon <code>p</code> to cell <code>c</code>, defaulting to plain styling. If <code>p</code> has more than 8190 (set by DeviceLayout&#39;s <code>GDS_POLYGON_MAX</code> constant), then it is partitioned into smaller polygons which are then rendered. Environment variable <code>ENV[&quot;GDS_POLYGON_MAX&quot;]</code> will override this constant. The partitioning algorithm implements guillotine cutting, that goes through at least one existing vertex and in manhattan directions. Cuts are selected by ad hoc optimzation for &quot;nice&quot; partitions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/render/polygons.jl#L3-L13">source</a></section><section><div><pre><code class="language-julia hljs">render!(c::CoordinateSystem, ent, meta)</code></pre><p>Synonym for <a href="../coordinate_systems/#DeviceLayout.CoordinateSystems.place!"><code>place!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/render/polygons.jl#L86-L90">source</a></section><section><div><pre><code class="language-julia hljs">render!(cell::Cell{S}, cs::GeometryStructure;
    memoized_cells=Dict{CoordinateSystem, Cell}(),
    map_meta = identity,
    kwargs...) where {S}</code></pre><p>Render a geometry structure (e.g., <code>CoordinateSystem</code>) to a cell.</p><p>Passes each element and its metadata (mapped by <code>map_meta</code> if a method is supplied) to <code>render!(::Cell, element, ::Meta)</code>, traversing the references such that if a CoordinateSystem is referred to in multiple places, it will become a single cell referred to in multiple places.</p><p>Rendering a <code>GeometryEntity</code> to a <code>Cell</code> uses the optional keyword arguments</p><ul><li><code>map_meta</code>, a function that takes a <code>Meta</code> object and returns another <code>Meta</code> object (or <code>nothing</code>, in which case rendering is skipped)</li></ul><p>Usage note: calling this function with non-empty dictionary <code>memoized_cells = Dict{CoordinateSystem, Cell}(cs =&gt; cell)</code> is effectively a manual override that forces <code>cs</code> to render as <code>cell</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/render/render.jl#L175-L196">source</a></section><section><div><pre><code class="language-julia hljs">render!(sm::SolidModel, cs::AbstractCoordinateSystem{T}; map_meta=layer, postrender_ops=[], zmap=(_) -&gt; zero(T), kwargs...) where {T}</code></pre><p>Render <code>cs</code> to <code>sm</code>.</p><p><strong>Keywords</strong></p><ul><li><code>map_meta</code>: Function (m::SemanticMeta) -&gt; name of <code>PhysicalGroup</code> (as <code>String</code> or <code>Symbol</code>; may also return <code>nothing</code> to skip rendering <code>m</code>)</li><li><code>postrender_ops</code>: Vector of Tuples <code>(destination, op, args, op_kwargs...)</code> specifying &quot;postrendering&quot; of <code>PhysicalGroup</code>s executed after entities have been rendered to to <code>sm</code>. Each operation <code>op</code> creates a new <code>PhysicalGroup</code> defined as <code>sm[destination] = op(sm, args...; op_kwargs...)</code>. That is, <code>args</code> are the arguments to <code>op</code> (following the first argument, which is always the model <code>sm</code> being rendered to). For most operations, these arguments include the names and dimensions of groups being operated on, and <code>op_kwargs</code> are the keyword arguments passed to <code>op</code>. For example, <code>(&quot;base&quot;, difference_geom!, (&quot;writeable_area&quot;, &quot;base_negative&quot;), :remove_object =&gt; true, :remove_tool =&gt; true)</code> defines a postrendering step that subtracts the <code>PhysicalGroup</code> named <code>&quot;base_negative&quot;</code> from <code>&quot;writeable_area&quot;</code> (by default using dimension 2 for each group) to define a new group called <code>&quot;base&quot;</code>. The keyword pairs <code>:remove_object=&gt;true</code> and <code>:remove_tool=&gt;true</code> mean that the &quot;object&quot; (first argument) group <code>&quot;writeable_area&quot;</code> and the &quot;tool&quot; (second argument) group <code>&quot;base_negative&quot;</code> are both removed when <code>&quot;base&quot;</code> is created.</li><li><code>zmap</code>: Function (m::SemanticMeta) -&gt; <code>z</code> coordinate of corresponding elements. Default: Map all metadata to zero.</li><li><code>meshing_parameters</code>: <code>MeshingParameters</code> allows customization of the top level meshing parameters when calling Gmsh.</li></ul><p>Available postrendering operations are <a href="../solidmodels/#DeviceLayout.SolidModels.translate!"><code>translate!</code></a>, <a href="../solidmodels/#DeviceLayout.SolidModels.extrude_z!"><code>extrude_z!</code></a>, <a href="../solidmodels/#DeviceLayout.SolidModels.revolve!"><code>revolve!</code></a>, <a href="../solidmodels/#DeviceLayout.SolidModels.union_geom!"><code>union_geom!</code></a>, <a href="../solidmodels/#DeviceLayout.SolidModels.intersect_geom!"><code>intersect_geom!</code></a>, <a href="../solidmodels/#DeviceLayout.SolidModels.difference_geom!"><code>difference_geom!</code></a>, <a href="../solidmodels/#DeviceLayout.SolidModels.fragment_geom!"><code>fragment_geom!</code></a>, and <a href="../solidmodels/#DeviceLayout.SolidModels.box_selection"><code>box_selection</code></a>. (The geometric Boolean operations are only available for models using the OpenCASCADE kernel.)</p><p>Additional keyword arguments are passed to <a href="../solidmodels/#DeviceLayout.SolidModels.to_primitives"><code>SolidModels.to_primitives</code></a> (which falls back to <a href="../geometry/#DeviceLayout.to_polygons"><code>to_polygons</code></a>) and may be used for certain entity types to control how entities of <code>cs</code> are converted to primitives and added to <code>sm</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/solidmodels/render.jl#L481-L514">source</a></section><section><div><pre><code class="language-julia hljs">render!(cs::AbstractCoordinateSystem, obj::GeometryEntity, meta::DeviceLayout.Meta,
    target::LayoutTarget; kwargs...)</code></pre><p>Render <code>obj</code> to <code>cs</code>, with metadata mapped to layers and rendering options by <code>target</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/targets.jl#L326-L331">source</a></section><section><div><pre><code class="language-julia hljs">render!(cs::AbstractCoordinateSystem, cs2::GeometryStructure, target::LayoutTarget; kwargs...)</code></pre><p>Render <code>cs2</code> to <code>cs</code>, with metadata mapped to layers and rendering options by <code>target</code>.</p><p>See <a href="../schematicdriven/targets/#DeviceLayout.SchematicDrivenLayout.LayoutTarget"><code>LayoutTarget</code></a> documentation for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/targets.jl#L342-L348">source</a></section><section><div><pre><code class="language-julia hljs">render!(
    cs::AbstractCoordinateSystem,
    sch::Schematic,
    target::LayoutTarget;
    strict=:error,
    kwargs...
)</code></pre><p>Run <code>build!(sch, target)</code> and render the resulting geometry to <code>cs</code> using <code>target</code>&#39;s rendering options.</p><p>The <code>strict</code> keyword should be <code>:error</code>, <code>:warn</code>, or <code>:no</code>.</p><p>The <code>strict=:error</code> keyword option causes <code>render!</code> to throw an error if any errors were logged while building component geometries or while rendering geometries to <code>cs</code>. This is enabled by default, but can be disabled with <code>strict=:no</code>, in which case any component which was not successfully built will have an empty geometry, and any non-fatal rendering errors will be ignored as usual. Using <code>strict=:no</code> is recommended only for debugging purposes.</p><p>The <code>strict=:warn</code> keyword option causes <code>render!</code> to throw an error if any warnings were logged. This is disabled by default. Using <code>strict=:warn</code> is suggested for use in automated pipelines, where warnings may require human review.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/schematics.jl#L1339-L1362">source</a></section><section><div><pre><code class="language-julia hljs">render!(sm::SolidModel, sch::Schematic, target::Target; strict=:error, kwargs...)</code></pre><p>Render <code>sch</code> to <code>sm</code>, using rendering settings from <code>target</code>.</p><p>The <code>strict</code> keyword should be <code>:error</code>, <code>:warn</code>, or <code>:no</code>.</p><p>The <code>strict=:error</code> keyword option causes <code>render!</code> to throw an error if any errors were logged while building component geometries or while rendering geometries to <code>cs</code>. This is enabled by default, but can be disabled with <code>strict=:no</code>, in which case any component which was not successfully built will have an empty geometry, and any non-fatal rendering errors will be ignored as usual. Using <code>strict=:no</code> is recommended only for debugging purposes.</p><p>The <code>strict=:warn</code> keyword option causes <code>render!</code> to throw an error if any warnings were logged. This is disabled by default. Using <code>strict=:warn</code> is suggested for use in automated pipelines, where warnings may require human review.</p><p>Additional keyword arguments may be used for certain entity types for controlling how geometry entities are converted to primitives and added to <code>sm</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/schematics/solidmodels.jl#L142-L162">source</a></section></article><h2 id="Rendering-arbitrary-paths"><a class="docs-heading-anchor" href="#Rendering-arbitrary-paths">Rendering arbitrary paths</a><a id="Rendering-arbitrary-paths-1"></a><a class="docs-heading-anchor-permalink" href="#Rendering-arbitrary-paths" title="Permalink"></a></h2><p>A <code>Segment</code> and <code>Style</code> together define one or more closed curves in the plane. The job of rendering is to approximate these curves by closed polygons. To enable rendering of styles along generic paths in the plane, an adaptive algorithm is used when no other method is available:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeviceLayout.adapted_grid" href="#DeviceLayout.adapted_grid"><code>DeviceLayout.adapted_grid</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">adapted_grid(f, anchors;
    max_recursions::Real = 7, max_change = 5°, rand_factor::Real = 0.05,
    grid_step = 1.0μm)</code></pre><p>Computes a resampled <code>grid</code> given anchor points so that <code>f.(grid)</code> is sufficiently smooth. The method used is to create an initial grid around the anchor points and refine intervals. When an interval becomes &quot;straight enough&quot; it is no longer divided. Adapted from a contribution to PlotUtils.jl from Kristoffer Carlsson.</p><ul><li><code>max_recursions</code>: how many times each interval is allowed to be refined.</li><li><code>max_change</code>: specifies acceptable change between evaluations of <code>f</code> on subsequent grid points, as estimated by the derivative times the distance between grid points. Typically, <code>f</code> is the angle of a path in the plane, so this is often an angle threshold. This condition is approximately valid in the end result, but may be weakly violated. This condition may be grossly violated if <code>max_recursions</code> is too low.</li><li><code>rand_factor</code>: between anchor points, <code>adapted_grid</code> will wiggle initial grid points a bit to prevent aliasing. The wiggling is sampled uniformly from the interval: <code>[-rand_factor, rand_factor]</code>, times the distance between three grid points (e.g. <code>i+1</code> and <code>i-1</code>). A random number generator is given a fixed seed every time <code>adapted_grid</code> is called, so the rendered results are deterministic.</li><li><code>grid_step</code>: Step size for initial grid points. If you set this to be larger than the maximum anchor point, then the lowest resolution consistent with <code>max_change</code> is used (unless <code>f</code> has some fast variations that the algorithm might miss).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/aws-cqc/DeviceLayout.jl/blob/89c9228ef5c3593070ef47c44c8141f19efd9067/src/utils.jl#L1-L25">source</a></section></article><p>In some cases, custom rendering methods are implemented when it would improve performance for simple structures or when special attention is required. The rendering methods can specialize on either the <code>Segment</code> or <code>Style</code> types, or both.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../autofill/">« Autofill</a><a class="docs-footer-nextpage" href="../solidmodels/">Solid Models (3D Geometry) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Thursday 27 February 2025 13:39">Thursday 27 February 2025</span>. Using Julia version 1.10.8.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
